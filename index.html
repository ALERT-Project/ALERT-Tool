<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALERT Nursing Risk Assessment Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F0F9F9;
        }
        .category-2 { background-color: #4FD1C5; color: #134E4A; }
        .category-1 { background-color: #F6E05E; color: #1A202C; }
        .category-1-high { background-color: #F97316; color: #FFFFFF; }
        .unsafe { background-color: #FC8181; color: #1A202C; }
        .header-gradient {
            background: linear-gradient(to right, #0D9488, #0F766E);
        }
        .final-score-bg {
            background-color: #134E4A;
        }
        .form-input {
            @apply mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 p-2 text-sm;
        }
        .sub-label {
            @apply block text-sm font-medium text-gray-600;
        }
        .module-bg-a { background-color: #fff1f2; }
        .module-bg-b { background-color: #f0f9ff; }
        .module-bg-c { background-color: #f0fdf4; }
        .module-bg-d { background-color: #fffbeb; }
        .module-bg-e { background-color: #fef2f2; }
        .module-bg-f { background-color: #faf5ff; }
        .module-title {
            @apply font-bold text-xl mb-3 p-3 rounded-t-lg;
        }
        .remove-btn {
            @apply ml-2 text-red-500 hover:text-red-700 font-bold;
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">

    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-xl shadow-lg mb-6 overflow-hidden">
            <div class="header-gradient p-6 flex items-center justify-center text-white">
                  <div class="bg-white/20 rounded-full p-2 mr-4">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                </div>
                <h1 class="text-2xl sm:text-3xl font-bold">ALERT Nursing Risk Assessment Tool</h1>
            </div>
            <div class="p-6 bg-gray-100 border-t-4 border-teal-100 border rounded-b-xl">
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                    <div>
                        <label for="patientInitials" class="block font-medium text-gray-700">Patient Initials:</label>
                        <input type="text" id="patientInitials" class="form-input bg-white">
                    </div>
                    <div>
                        <label for="urnLast4" class="block font-medium text-gray-700">Last 4 Digits of URN:</label>
                        <input type="text" id="urnLast4" class="form-input bg-white">
                    </div>
                     <div>
                        <label for="ward" class="block font-medium text-gray-700">Ward & Room No.:</label>
                        <div class="flex space-x-2">
                            <input type="text" id="ward" class="form-input bg-white" placeholder="Ward">
                            <input type="text" id="roomNumber" class="form-input bg-white" placeholder="Room">
                        </div>
                    </div>
                    <div>
                        <label for="losDays" class="block font-medium text-gray-700">ICU LOS (days):</label>
                        <input type="number" id="losDays" min="0" class="form-input bg-white">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-xl shadow-lg mb-6 p-6">
            <h2 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">Clinical Parameters (for auto-scoring)</h2>
            <div class="mb-6 bg-gray-50 p-4 rounded-lg border border-gray-200">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-semibold text-gray-700">A-E Assessment</h3>
                    <div class="text-right">
                        <span class="text-sm font-medium text-gray-500">Calculated ADDS:</span>
                        <span id="calculatedADDSScore" class="font-bold text-lg text-teal-600">0</span>
                    </div>
                </div>
                <div class="flex flex-wrap gap-x-6 gap-y-4">
                    <div class="flex-grow basis-24 min-w-[120px]"><label class="sub-label">Airway</label><input type="text" id="airway_input" class="form-input" value="Patent"></div>
                    <div class="flex-grow basis-24 min-w-[120px]"><label class="sub-label">Resp Rate</label><input type="number" id="rr_input" class="form-input vital-input"></div>
                    <div class="flex-grow basis-24 min-w-[120px]"><label class="sub-label">SpO2 (%)</label><input type="number" id="spo2_input" class="form-input vital-input"></div>
                    <div class="flex items-end space-x-2 flex-grow basis-48 min-w-[220px]">
                        <div><label class="sub-label">O2 Flow</label><input type="number" id="o2_flow_input" class="form-input vital-input w-24" placeholder="Value"></div>
                        <div><label class="sub-label">Unit</label><select id="o2_unit_input" class="form-input vital-input w-28"><option value="lpm">L/min</option><option value="fio2">% FiO2</option></select></div>
                    </div>
                    <div class="flex-grow basis-24 min-w-[120px]"><label class="sub-label">Heart Rate</label><input type="number" id="hr_input" class="form-input vital-input"></div>
                    <div class="flex-grow basis-24 min-w-[120px]"><label class="sub-label">SBP (mmHg)</label><input type="number" id="sbp_input" class="form-input vital-input"></div>
                    <div class="flex-grow basis-24 min-w-[120px]"><label class="sub-label">DBP (mmHg)</label><input type="number" id="dbp_input" class="form-input"></div>
                    <div class="flex-grow basis-24 min-w-[120px]"><label class="sub-label">Consciousness</label><select id="consciousness_input" class="form-input vital-input"><option value="0">Alert</option><option value="1">Voice</option><option value="2">Pain</option><option value="3">Unresponsive</option></select></div>
                    <div class="flex-grow basis-24 min-w-[120px]"><label class="sub-label">Temp (Â°C)</label><input type="number" step="0.1" id="temp_input" class="form-input vital-input"></div>
                    <div class="flex-grow basis-24 min-w-[120px]"><label class="sub-label">Urine Output</label><input type="text" id="urine_input" class="form-input" placeholder=""></div>
                </div>
            </div>
             <div class="mb-6 bg-gray-50 p-4 rounded-lg border border-gray-200">
                <h3 class="font-semibold text-gray-700 mb-2">ADDS Modifications</h3>
                <div class="space-y-2">
                    <label class="flex items-center"><input type="checkbox" id="addsModificationCheckbox"> <span class="ml-2 text-sm">Apply clinical modification to ADDS</span></label>
                    <div id="addsModificationDetails" class="hidden ml-6 mt-2 space-y-2">
                        <div>
                            <label for="addsModificationText" class="sub-label">Modification Details:</label>
                            <textarea id="addsModificationText" rows="2" class="form-input"></textarea>
                        </div>
                        <div class="flex items-end space-x-4">
                            <div>
                                <label for="addsModificationStartTime" class="sub-label">Modification Start Time:</label>
                                <input type="datetime-local" id="addsModificationStartTime" class="form-input">
                            </div>
                            <div>
                                <label for="addsModificationDuration" class="sub-label">Duration Set (hours):</label>
                                <select id="addsModificationDuration" class="form-input">
                                    <option value="2">2 hrs</option>
                                    <option value="4">4 hrs</option>
                                    <option value="6">6 hrs</option>
                                    <option value="12">12 hrs</option>
                                    <option value="24">24 hrs</option>
                                    <option value="48">48 hrs</option>
                                    <option value="72">72 hrs</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
             <div class="mb-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <h3 class="font-semibold text-gray-700 mb-2">Fluid Balance</h3>
                    <div class="flex flex-wrap gap-4">
                        <div><label class="sub-label">24hr Fluid Balance (L)</label><input type="number" step="0.1" id="fbc_24hr_input" class="form-input fluid-input w-36" placeholder="+/- L"></div>
                        <div><label class="sub-label">Total ICU Balance (L)</label><input type="number" step="0.1" id="fbc_total_input" class="form-input fluid-input w-36" placeholder="+/- L"></div>
                    </div>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <h3 class="font-semibold text-gray-700 mb-2">Cognition</h3>
                    <div>
                        <label class="sub-label">AMT Score</label>
                        <select id="amt_score_input" class="form-input w-48"><option value="Not Assessed">Not Assessed</option><option value="4/4">4/4</option><option value="3/4">3/4</option><option value="2/4">2/4</option><option value="1/4">1/4</option><option value="0/4">0/4</option></select>
                    </div>
                </div>
            </div>
             <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                <h3 class="font-semibold text-gray-700 mb-2">Key Bloods</h3>
                <div class="flex flex-wrap gap-x-6 gap-y-4 items-end">
                    <div class="flex items-end space-x-2"><div class="w-24"><label class="sub-label">Lactate</label><input type="number" step="0.1" id="lactate_input" class="form-input blood-input" placeholder="Current"></div><div class="w-24"><input type="number" step="0.1" id="lactate_input_prev" class="form-input blood-input" placeholder="Prev."></div></div>
                    <div class="flex items-end space-x-2"><div class="w-24"><label class="sub-label">Creatinine</label><input type="number" id="creatinine_input" class="form-input blood-input" placeholder="Current"></div><div class="w-24"><input type="number" id="creatinine_input_prev" class="form-input blood-input" placeholder="Prev."></div></div>
                    <div class="flex items-end space-x-2"><div class="w-24"><label class="sub-label">Albumin</label><input type="number" id="albumin_input" class="form-input blood-input" placeholder="Current"></div><div class="w-24"><input type="number" id="albumin_input_prev" class="form-input blood-input" placeholder="Prev."></div></div>
                    <div class="flex items-end space-x-2"><div class="w-24"><label class="sub-label">CRP</label><input type="number" id="crp_input" class="form-input blood-input" placeholder="Current"></div><div class="w-24"><input type="number" id="crp_input_prev" class="form-input blood-input" placeholder="Prev."></div></div>
                    <div class="flex items-end space-x-2"><div class="w-24"><label class="sub-label">Hb</label><input type="number" id="hb_input" class="form-input blood-input" placeholder="Current"></div><div class="w-24"><input type="number" id="hb_input_prev" class="form-input blood-input" placeholder="Prev."></div></div>
                    <div class="flex items-end space-x-2"><div class="w-24"><label class="sub-label">K+</label><input type="number" step="0.1" id="k_input" class="form-input blood-input" placeholder="Current"></div><div class="w-24"><input type="number" step="0.1" id="k_input_prev" class="form-input blood-input" placeholder="Prev."></div></div>
                    <div class="flex items-end space-x-2"><div class="w-24"><label class="sub-label">Mg++</label><input type="number" step="0.1" id="mg_input" class="form-input blood-input" placeholder="Current"></div><div class="w-24"><input type="number" step="0.1" id="mg_input_prev" class="form-input blood-input" placeholder="Prev."></div></div>
                </div>
                 <div class="mt-4 pt-4 border-t border-gray-300">
                    <label class="flex items-center">
                        <input type="checkbox" id="cts_cardiac_checkbox" class="blood-input">
                        <span class="ml-2 text-sm font-medium text-gray-700">CTS/Cardiac Patient (apply stricter K+/Mg++ targets)</span>
                    </label>
                </div>
            </div>
        </div>

        <div id="scoringContainer">
            <div class="bg-white rounded-xl shadow-lg mb-6 p-6">
               <h2 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">RISK SCORING ASSESSMENT</h2>
               <div class="space-y-6">
                    <div class="p-4 rounded-lg module-bg-a"><h3 class="module-title bg-rose-200 text-rose-800">Critical Risk Factors</h3><div class="space-y-2 p-4"><label class="flex items-center"><input type="checkbox" class="score-input" data-score="15" data-id="crit_met" id="crit_met_checkbox"> <span class="ml-2">Currently in MET criteria (+15)</span></label><label class="flex items-center"><input type="checkbox" class="score-input" data-score="10" data-id="crit_adds4" id="crit_adds4_checkbox"> <span class="ml-2">ADDS Score â¥ 4 (+10)</span></label><label class="flex items-center"><input type="checkbox" class="score-input" data-score="10" data-id="crit_lactate_high" id="crit_lactate_high_checkbox"> <span class="ml-2">Lactate â¥ 3.5 mmol/L (+10)</span></label><label class="flex items-center"><input type="checkbox" class="score-input" data-score="10" data-id="crit_af"> <span class="ml-2">Unstable Atrial Fibrillation (+10)</span></label><label class="flex items-center"><input type="checkbox" class="score-input" data-score="10" data-id="crit_hb_drop" id="crit_hb_drop_checkbox"> <span class="ml-2">New Hb drop >20g/L OR Active Bleeding (+10)</span></label></div></div>
                    <div class="rounded-lg module-bg-b"><h3 class="module-title bg-blue-200 text-blue-800">Physiological & Respiratory Stability</h3><div class="space-y-2 p-4"><label class="flex items-center"><input type="radio" name="adds_score" class="score-input" data-score="0" data-id="adds_0" id="adds_0_radio" checked> <span class="ml-2">Current ADDS Score 0 (+0)</span></label><label class="flex items-center"><input type="radio" name="adds_score" class="score-input" data-score="1" data-id="adds_1-2" id="adds_1-2_radio"> <span class="ml-2">Current ADDS Score 1-2 (+1)</span></label><label class="flex items-center"><input type="radio" name="adds_score" class="score-input" data-score="5" data-id="adds_3" id="adds_3_radio"> <span class="ml-2">Current ADDS Score 3 (+5)</span></label><label class="flex items-center"><input type="checkbox" class="score-input" data-score="5" data-id="adds_worsening"> <span class="ml-2">Worsening ADDS Trend (last 12-24h) (+5)</span></label><hr class="my-3"><label class="flex items-center"><input type="checkbox" class="score-input" data-score="10" data-id="resp_increasing_o2"> <span class="ml-2">Increasing O2 requirements in last 12h (+10)</span></label><label class="flex items-center"><input type="checkbox" class="score-input" data-score="6" data-id="resp_rapid_wean"> <span class="ml-2">Rapid weaning of respiratory support in last 4h (+6)</span></label></div></div>
                    <div class="p-4 rounded-lg module-bg-c"><h3 class="module-title bg-green-200 text-green-800">Bloods</h3><div class="space-y-2 p-4"><label class="flex items-center"><input type="checkbox" class="score-input" data-score="4" data-id="bloods_electrolytes" id="bloods_electrolytes"> <span class="ml-2">Abnormal Electrolytes (K+, Mg++, Na+, Phos) (+4)</span></label><hr class="my-2"><label class="flex items-center"><input type="checkbox" class="score-input" data-score="4" data-id="bloods_lactate_mid" id="bloods_lactate_mid_checkbox"> <span class="ml-2">Lactate 2.0 - 3.4 (+4)</span></label><label class="flex items-center"><input type="checkbox" class="score-input" data-score="4" data-id="bloods_creatinine" id="bloods_creatinine_checkbox"> <span class="ml-2">Creatinine >200 Âµmol/L (+4)</span></label><label class="flex items-center"><input type="checkbox" class="score-input" data-score="3" data-id="bloods_albumin" id="bloods_albumin_checkbox"> <span class="ml-2">Albumin <25 g/L (+3)</span></label><label class="flex items-center"><input type="checkbox" class="score-input" data-score="3" data-id="bloods_crp" id="bloods_crp_checkbox"> <span class="ml-2">CRP >100 mg/L (static/rising) (+3)</span></label><label class="flex items-center"><input type="checkbox" class="score-input" data-score="3" data-id="bloods_anaemia" id="bloods_anaemia_checkbox"> <span class="ml-2">Anaemia (Hb < 80 g/L) (+3)</span></label></div></div>
                    <div class="p-4 rounded-lg module-bg-d"><h3 class="module-title bg-yellow-200 text-yellow-800">Clinical</h3><div class="space-y-2 p-4"><label class="flex items-center"><input type="radio" name="pain_score" class="score-input" data-score="0" data-id="pain_0" checked> <span class="ml-2 text-gray-500">Pain: None / Well Controlled</span></label><label class="flex items-center"><input type="radio" name="pain_score" class="score-input" data-score="3" data-id="pain_iv"> <span class="ml-2">Pain: Requires regular IV/potent analgesia (+3)</span></label><label class="flex items-center"><input type="radio" name="pain_score" class="score-input" data-score="5" data-id="pain_pca"> <span class="ml-2">Pain: Poorly controlled / PCA (+5)</span></label><hr class="my-2"><label class="flex items-center"><input type="radio" name="fluid_status_score" class="score-input" data-score="0" data-id="fluid_0" id="fluid_0_radio" checked> <span class="ml-2 text-gray-500">Fluid Status: Euvolaemic</span></label><label class="flex items-center"><input type="radio" name="fluid_status_score" class="score-input" data-score="2" data-id="fluid_mild" id="fluid_mild_radio"> <span class="ml-2">Mild Dehydration/Overload (+2)</span></label><label class="flex items-center"><input type="radio" name="fluid_status_score" class="score-input" data-score="4" data-id="fluid_sig" id="fluid_sig_radio"> <span class="ml-2">Significant Dehydration/Overload (+4)</span></label><hr class="my-2"><label class="flex items-center"><input type="radio" name="diet_score" class="score-input" data-score="0" data-id="diet_0" checked> <span class="ml-2 text-gray-500">Diet: Normal</span></label><label class="flex items-center"><input type="radio" name="diet_score" class="score-input" data-score="2" data-id="diet_modified"> <span class="ml-2">Diet: Supplements / Modified (+2)</span></label><label class="flex items-center"><input type="radio" name="diet_score" class="score-input" data-score="4" data-id="diet_nbm"> <span class="ml-2">Diet: NBM / NG / TPN (+4)</span></label><label class="flex items-center"><input type="checkbox" class="score-input" data-score="3" data-id="bowels_issue"> <span class="ml-2">Bowels: Not opened >3 days / Ileus (+3)</span></label><hr class="my-2"><label class="flex items-center"><input type="radio" name="delirium_score" class="score-input" data-score="0" data-id="delirium_0" checked> <span class="ml-2 text-gray-500">Delirium: None</span></label><label class="flex items-center"><input type="radio" name="delirium_score" class="score-input" data-score="4" data-id="delirium_mild"> <span class="ml-2">Delirium: Mild / Subsyndromal (+4)</span></label><label class="flex items-center"><input type="radio" name="delirium_score" class="score-input" data-score="8" data-id="delirium_mod"> <span class="ml-2">Delirium: Moderate to Severe (+8)</span></label><hr class="my-2"><label class="flex items-center"><input type="radio" name="mobility_score" class="score-input" data-score="0" data-id="mobility_0" checked> <span class="ml-2 text-gray-500">Mobility: At Baseline</span></label><label class="flex items-center"><input type="radio" name="mobility_score" class="score-input" data-score="2" data-id="mobility_assisted"> <span class="ml-2">Mobility: Assisted (+2)</span></label><label class="flex items-center"><input type="radio" name="mobility_score" class="score-input" data-score="5" data-id="mobility_bedbound"> <span class="ml-2">Mobility: Bed-bound (+5)</span></label><hr class="my-2"><label class="flex items-center"><input type="radio" name="airway_score" class="score-input" data-score="0" data-id="airway_0" checked> <span class="ml-2 text-gray-500">Airway: Good Cough</span></label><label class="flex items-center"><input type="radio" name="airway_score" class="score-input" data-score="4" data-id="airway_weak"> <span class="ml-2">Airway: Weak cough (+4)</span></label><label class="flex items-center"><input type="checkbox" class="score-input" data-score="5" data-id="airway_altered"> <span class="ml-2">Altered Airway (Trach/Lary) (+5)</span></label><hr class="my-2"><label class="flex items-center"><input type="radio" name="lines_score" class="score-input" data-score="0" data-id="lines_0" checked> <span class="ml-2 text-gray-500">Lines: None / PIVC only</span></label><label class="flex items-center"><input type="radio" name="lines_score" class="score-input" data-score="5" data-id="lines_cvc"> <span class="ml-2">Lines: CVC or Vascath (+5)</span></label><label class="flex items-center"><input type="checkbox" class="score-input" data-score="3" data-id="drains_high_risk"> <span class="ml-2">High-Risk Drain present (+3)</span></label><hr class="my-2"><div class="pt-2"><label class="flex items-center"><input type="radio" name="concern_score" class="score-input" data-score="0" data-id="concern_0" checked> <span class="ml-2 text-gray-500">Nursing Concern: None</span></label><label class="flex items-center"><input type="radio" name="concern_score" class="score-input" data-score="5" data-id="concern_present"> <span class="ml-2">Nursing Concern Present (+5)</span></label><textarea id="nursingConcernText" class="mt-2 ml-6 w-full rounded-md border-gray-300 shadow-sm text-sm" rows="2" placeholder="Specify concern..." style="display: none;"></textarea></div></div></div>
                    <div class="p-4 rounded-lg module-bg-e"><h3 class="module-title bg-red-200 text-red-800">Systemic</h3><div class="space-y-2 p-4"><label class="flex items-center"><input type="checkbox" id="losCheckbox" class="score-input" data-score="4" data-id="systemic_los"> <span class="ml-2">LOS > 3 days (+4)</span></label><label class="flex items-center"><input type="radio" name="frailty_score" class="score-input" data-score="0" data-id="frailty_0" checked> <span class="ml-2 text-gray-500">Frailty: Not Frail</span></label><label class="flex items-center"><input type="radio" name="frailty_score" class="score-input" data-score="2" data-id="frailty_mild"> <span class="ml-2">Frailty: Mild (+2)</span></label><label class="flex items-center"><input type="radio" name="frailty_score" class="score-input" data-score="4" data-id="frailty_mod"> <span class="ml-2">Frailty: Mod-Severe (+4)</span></label><label class="flex items-center"><input type="checkbox" class="score-input" data-score="4" id="comorbiditiesCheckbox" data-id="systemic_comorbid"> <span class="ml-2"><span class="comorbidity-main-text">â¥3 chronic comorbidities</span> <span class="text-gray-400 text-xs">(e.g. IHD)</span> (+4)</span></label><label class="flex items-center"><input type="checkbox" class="score-input" data-score="3" data-id="systemic_ooh"> <span class="ml-2">Out-of-Hours Discharge (+3)</span></label></div></div>
               </div>
           </div>
       </div>

        <div class="bg-white rounded-xl shadow-lg mb-6 p-6">
            <h2 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">FINAL REVIEW & STRATIFICATION</h2>
            <div class="space-y-4">
                <div class="p-4 rounded-lg module-bg-f">
                    <h3 class="module-title bg-purple-200 text-purple-800">Post-ICU Syndrome (PICS) Screening</h3>
                    <div class="space-y-2 p-4">
                        <div class="flex flex-wrap items-center gap-x-6 gap-y-2">
                            <label class="flex items-center text-sm"><input type="radio" name="pics_status" value="negative" checked> <span class="ml-2">Completed: Negative</span></label>
                            <label class="flex items-center text-sm"><input type="radio" name="pics_status" value="positive"> <span class="ml-2">Completed: Positive</span></label>
                            <label class="flex items-center text-sm"><input type="radio" name="pics_status" value="unable"> <span class="ml-2">Unable to assess</span></label>
                        </div>
                        <div id="pics_unable_details" class="hidden ml-6 mt-2">
                            <label for="pics_unable_notes" class="sub-label">Reason:</label>
                            <textarea id="pics_unable_notes" rows="2" class="form-input"></textarea>
                        </div>
                    </div>
                </div>
                <div class="final-score-bg text-white rounded-xl shadow-lg p-6">
                     <div class="flex flex-col sm:flex-row justify-between items-center text-center">
                        <div class="mb-4 sm:mb-0"><span class="text-lg font-medium text-gray-400">TOTAL SCORE</span><div id="totalScore" class="text-5xl font-bold">0</div></div>
                        <div class="w-full sm:w-auto"><span class="text-lg font-medium text-gray-400">FINAL CATEGORY & ACTION</span><div id="riskCategory" class="text-xl font-bold p-3 rounded-md mt-1 transition-all duration-300">Category 2: Standard follow-up</div></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-xl shadow-lg mb-6 p-6">
            <h2 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">Optional Narrative Details for DMR</h2>
            <div class="grid grid-cols-1 gap-6 text-sm">
                <div><label for="admissionReason" class="block font-medium text-gray-600">Reason for ICU Admission:</label><textarea id="admissionReason" rows="2" class="form-input"></textarea></div>
                <div><label for="pmh" class="block font-medium text-gray-600">Past Medical History (PMH):</label><textarea id="pmh" rows="3" class="form-input"></textarea></div>
                <div><label for="icuSummary" class="block font-medium text-gray-600">ICU Summary / Timeline:</label><textarea id="icuSummary" rows="6" class="form-input"></textarea></div>
                
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <h3 class="font-semibold text-gray-700 mb-2">Devices, Drains & Wounds</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
                        <div>
                            <h4 class="font-medium text-gray-600 mb-2">Devices</h4>
                            <div class="space-y-2">
                                <label class="flex items-center"><input type="checkbox" id="device_cvc"> <span class="ml-2">CVC</span></label>
                                <label class="flex items-center"><input type="checkbox" id="device_vascath"> <span class="ml-2">Vascath</span></label>
                                <label class="flex items-center"><input type="checkbox" id="device_idc"> <span class="ml-2">IDC</span></label>
                                <label class="flex items-center"><input type="checkbox" id="device_ng"> <span class="ml-2">NG Tube</span></label>
                                <label class="flex items-center"><input type="checkbox" id="device_pacing_wire"> <span class="ml-2">Epicardial Pacing Wires</span></label>
                                <div class="flex items-center space-x-2 pt-1">
                                    <input type="checkbox" id="device_other">
                                    <input type="text" id="device_other_text" placeholder="Other device..." class="text-sm p-1 border rounded-md w-full">
                                </div>
                            </div>
                        </div>
                         <div>
                            <h4 class="font-medium text-gray-600 mb-2">Drains</h4>
                            <div id="drains_container" class="space-y-2"></div>
                            <button type="button" id="addDrainButton" class="mt-2 text-sm bg-teal-100 text-teal-800 hover:bg-teal-200 px-3 py-1 rounded-md">+ Add Drain</button>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-600 mb-2">Wounds</h4>
                            <div id="wounds_container" class="space-y-2"></div>
                            <button type="button" id="addWoundButton" class="mt-2 text-sm bg-pink-100 text-pink-800 hover:bg-pink-200 px-3 py-1 rounded-md">+ Add Wound</button>
                        </div>
                    </div>
                </div>
                
                <div><label for="impression" class="block font-medium text-gray-600">Impression:</label><textarea id="impression" rows="3" class="form-input"></textarea></div>
                <div><label for="emrAdditionalNotes" class="block font-medium text-gray-600">Additional Plan Notes:</label><textarea id="emrAdditionalNotes" rows="3" class="form-input"></textarea></div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-lg mt-6 p-6">
            <h2 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">DMR Summary Generator</h2>
            <div class="flex space-x-4 mb-4"><button id="generateSummaryButton" class="bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded-lg transition-colors w-1/2">Generate DMR Summary</button><button id="copySummaryButton" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors w-1/2">Copy to Clipboard</button></div>
            <textarea id="emrSummary" rows="15" class="w-full p-2 border border-gray-300 rounded-md bg-gray-50" readonly placeholder="Your summary will appear here..."></textarea>
            <div class="mt-6 text-center"><button id="resetButton" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Reset Form</button></div>
        </div>
    </div>
    
    <div class="text-center mt-8 text-gray-500 text-sm">Major update version 2</div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- ELEMENT SELECTORS ---
            const scoreInputs = document.querySelectorAll('.score-input');
            const totalScoreEl = document.getElementById('totalScore');
            const riskCategoryEl = document.getElementById('riskCategory');
            const resetButton = document.getElementById('resetButton');
            const generateSummaryButton = document.getElementById('generateSummaryButton');
            const copySummaryButton = document.getElementById('copySummaryButton');
            const emrSummaryEl = document.getElementById('emrSummary');
            const bloodInputs = document.querySelectorAll('.blood-input');
            const calculatedADDSEl = document.getElementById('calculatedADDSScore');
            const addsModCheckbox = document.getElementById('addsModificationCheckbox');
            const addsModDetails = document.getElementById('addsModificationDetails');
            const addDrainButton = document.getElementById('addDrainButton');
            const drainsContainer = document.getElementById('drains_container');
            const addWoundButton = document.getElementById('addWoundButton');
            const woundsContainer = document.getElementById('wounds_container');
            const picsRadios = document.querySelectorAll('input[name="pics_status"]');
            const picsUnableDetails = document.getElementById('pics_unable_details');

            // --- DATA MAPS ---
            const categoryMap = {'unsafe':'Unsafe for Ward: Immediate senior review required','category-1-high':'Category 1 - High Risk: Escalate to ALERT medical rounding team','category-1':'Category 1: Enhanced follow-up for 72 hours','category-2':'Category 2: Standard follow-up'};
            const carePlanMap = {'resp_increasing_o2':'Respiratory Risk: Perform focused respiratory assessment. Escalate for review of increasing O2 demand.','resp_rapid_wean':'Respiratory Risk: Increase frequency of respiratory observations. Monitor for signs of fatigue.','bloods_electrolytes':'Biochemical Risk: Monitor electrolyte trends. Ensure replacement therapy is charted and administered.','bloods_lactate_mid':'Biochemical Risk: Liaise with medical team for serial lactate measurements to ensure clearance.','bloods_creatinine':'Renal Risk: Maintain strict fluid balance chart. Monitor renal function. Review nephrotoxic medications.','bloods_albumin':'Nutritional Risk: Refer to Dietitian for nutritional assessment. Monitor for oedema and poor wound healing.','bloods_crp':'Infection/Inflammatory Risk: Continue vigilant monitoring for signs of infection. Ensure timely antibiotics.','bloods_anaemia':'Bleeding Risk: Monitor for signs of active bleeding. Discuss transfusion threshold with medical team.','pain_iv':'Pain Management: Perform comprehensive pain assessment. Escalate to Acute Pain Service if poorly controlled.','pain_pca':'Pain Management: Perform comprehensive pain assessment. Escalate to Acute Pain Service if poorly controlled.','fluid_mild':'Fluid Balance Risk: Maintain strict fluid balance chart. Perform clinical fluid assessment.','fluid_sig':'Fluid Balance Risk: Maintain strict fluid balance chart. Perform clinical fluid assessment.','diet_modified':'Nutritional Risk: Ensure referrals to Dietitian/Speech Pathology are in place. Monitor intake.','diet_nbm':'Nutritional Risk: Ensure referrals to Dietitian/Speech Pathology are in place. Monitor intake.','bowels_issue':'Gastrointestinal Risk: Implement bowel management plan. Monitor for signs of ileus.','delirium_mild':'Cognitive Risk: Implement non-pharmacological delirium prevention/management strategies.','delirium_mod':'Cognitive Risk: Implement non-pharmacological delirium prevention/management strategies.','mobility_assisted':'Mobility Deficit: Ensure Physiotherapy referral is active. Implement pressure injury prevention strategies.','mobility_bedbound':'Mobility Deficit: Ensure Physiotherapy referral is active. Implement pressure injury prevention strategies.','airway_weak':'Airway Clearance Risk: Collaborate with Physiotherapy on secretion management plan.','airway_altered':'Airway Risk: Confirm ward staff competency with tracheostomy/laryngectomy care.','lines_cvc':'Infection Risk: Daily review of CVC necessity with medical team. Maintain strict ANTT for all access.','drains_high_risk':'Drain Management: Maintain vigilance over drain patency and output. Escalate any changes.','concern_present':"Nursing Concern: Articulate and escalate specific concerns to senior staff for 'fresh eyes' review.",'frailty_mild':'Frailty Risk: Ensure appropriate referrals (Geriatrics, OT, Physio). Focus on safe mobilization.','frailty_mod':'Frailty Risk: Ensure appropriate referrals (Geriatrics, OT, Physio). Focus on safe mobilization.','systemic_comorbid':'Systemic Risk: Confirm relevant specialty teams have been consulted and a consolidated plan is in place.','systemic_ooh':'Systemic Risk: Provide a detailed, structured handover to the after-hours team.','crit_met':'Critical Risk: Patient is in MET criteria. Initiate MET call and immediate resuscitation.','crit_adds4':'Critical Risk: Patient has high ADDS score. Escalate for urgent medical review (<30 mins).','crit_lactate_high':'Critical Risk: Patient is critically unwell. Escalate for immediate senior medical review for shock.','crit_af':'Critical Risk: Patient is in unstable AF. Escalate for urgent cardiology/medical review.','crit_hb_drop':'Critical Risk: Significant Hb drop or active bleeding. Escalate for urgent medical/surgical review.'};
            const assessmentNarrativeMap = {'crit_met':'currently in MET criteria','crit_adds4':'a high ADDS score','crit_lactate_high':'a critically high lactate','crit_af':'unstable atrial fibrillation','crit_hb_drop':'a significant drop in haemoglobin or active bleeding','adds_worsening':'a worsening trend in observations','resp_increasing_o2':'increasing oxygen requirements','resp_rapid_wean':'a recent rapid wean of respiratory support','bloods_lactate_mid':'a moderately elevated lactate','bloods_creatinine':'a significant renal impairment','bloods_albumin':'hypoalbuminaemia, indicating nutritional risk','bloods_crp':'a significant inflammatory response (CRP > 100)','pain_pca':'poorly controlled pain requiring advanced analgesia','fluid_sig':'a significant fluid imbalance','diet_nbm':'is receiving no oral nutrition (NBM/NG/TPN)','delirium_mod':'moderate to severe delirium','mobility_bedbound':'is currently bed-bound with significant mobility deficits','airway_altered':'a surgically altered airway (tracheostomy/laryngectomy)','concern_present':'specific concerns raised by the bedside nurse'};

            // --- CORE FUNCTIONS ---
            function getTrend(current, previous, higherIsWorse = true) { /* ... */ }
            function generateSummary() {
                let summaryText = 'ALERT CNS post ICU review on ward\n';
                const los = document.getElementById('losDays').value; if(los) summaryText += `ICU LOS ${los} days\n`;
                const admissionReason = document.getElementById('admissionReason').value.trim(); if(admissionReason) summaryText += `Admitted to ICU with ${admissionReason}\n\n`;
                const pmh = document.getElementById('pmh').value.trim(); if (pmh) summaryText += `PMH\n${pmh}\n\n`;
                const icuSummary = document.getElementById('icuSummary').value.trim(); if (icuSummary) summaryText += `Summary\n${icuSummary}\n\n`;
                summaryText += `ALERT Score: ${totalScoreEl.textContent} -> ${riskCategoryEl.textContent}\n\n`;

                const bloods = [];
                const addBlood = (name, id, higherIsWorse) => {
                    const current = parseFloat(document.getElementById(`${id}_input`).value);
                    const prev = parseFloat(document.getElementById(`${id}_input_prev`).value);
                    if (!isNaN(current)) bloods.push(`${name} ${current}${getTrend(current, prev, higherIsWorse)}`);
                };
                addBlood('Lac', 'lactate', true); addBlood('Cr', 'creatinine', true); addBlood('Alb', 'albumin', false);
                addBlood('CRP', 'crp', true); addBlood('Hb', 'hb', false); addBlood('K', 'k', false); addBlood('Mg', 'mg', false);
                if(bloods.length > 0) summaryText += `Bloods\n${bloods.join(', ')}\n\n`;
                
                let aeText = `ADDS ${calculatedADDSEl.textContent}\n`;
                if (addsModCheckbox.checked) {
                    const modText = document.getElementById('addsModificationText').value.trim();
                    const startTimeVal = document.getElementById('addsModificationStartTime').value;
                    const durationVal = document.getElementById('addsModificationDuration').value;
                    let expiryInfo = '';
                    if (startTimeVal && durationVal) {
                        const startTime = new Date(startTimeVal);
                        const endTime = new Date(startTime.getTime() + parseInt(durationVal, 10) * 3600 * 1000);
                        const remainingMillis = endTime - new Date();
                        if (remainingMillis > 0) {
                            const remainingHours = Math.round((remainingMillis / 3600000) * 10) / 10;
                            expiryInfo = ` (Expires in: approx. ${remainingHours} hours)`;
                        } else { expiryInfo = ' (Expired)'; }
                    }
                    if (modText) aeText += `!! ADDS MODIFICATION IN PLACE${expiryInfo}:\n${modText}\n`;
                }
                aeText += `A: ${document.getElementById('airway_input').value}\n`;
                const rr = document.getElementById('rr_input').value, spo2 = document.getElementById('spo2_input').value, o2Flow = document.getElementById('o2_flow_input').value, o2UnitEl = document.getElementById('o2_unit_input'), o2Unit = o2UnitEl.options[o2UnitEl.selectedIndex].text;
                let o2DeliveryInfo = 'RA'; if (o2Flow && o2Flow > 0) o2DeliveryInfo = `${o2Flow} ${o2Unit}`;
                if(rr || spo2) aeText += `B: RR ${rr || 'N/A'}, SpO2 ${spo2 || 'N/A'}% on ${o2DeliveryInfo}\n`;
                const hr = document.getElementById('hr_input').value, sbp = document.getElementById('sbp_input').value, dbp = document.getElementById('dbp_input').value;
                if(hr || sbp) aeText += `C: HR ${hr || 'N/A'}, NIBP ${sbp || 'N/A'}/${dbp || 'N/A'}\n`;
                const consciousnessEl = document.getElementById('consciousness_input'), consciousness = consciousnessEl.options[consciousnessEl.selectedIndex].text;
                aeText += `D: AVPU - ${consciousness}\n`;
                const temp = document.getElementById('temp_input').value; if(temp) aeText += `E: Temp ${temp}Â°C\n`;
                const amt = document.getElementById('amt_score_input').value; if(amt && amt !== "Not Assessed") aeText += `AMT: ${amt}\n`;
                summaryText += `${aeText}\n`;

                // --- NEW ASSESSMENT SUMMARY ---
                summaryText += `Assessment Summary\n`;
                const assessmentPoints = [];
                scoreInputs.forEach(input => {
                    if (input.checked && input.dataset.score !== "0" && assessmentNarrativeMap[input.dataset.id]) {
                        assessmentPoints.push(assessmentNarrativeMap[input.dataset.id]);
                    }
                });
                const picsStatus = document.querySelector('input[name="pics_status"]:checked').value;
                if (picsStatus === 'positive') assessmentPoints.push('a positive PICS screen');
                else if (picsStatus === 'unable') {
                    const reason = document.getElementById('pics_unable_notes').value.trim();
                    assessmentPoints.push(reason ? `PICS screening was unable to be completed due to ${reason}` : 'PICS screening was unable to be completed');
                }
                if(assessmentPoints.length > 0) {
                    summaryText += `Key nursing considerations include ${assessmentPoints.join(', ')}.\n\n`;
                } else {
                    summaryText += 'Patient is clinically stable with no significant risk factors identified.\n\n';
                }

                const impression = document.getElementById('impression').value.trim(); if (impression) summaryText += `Imp:\n${impression}\n\n`;
                summaryText += `Plan\n`;
                const carePlanItems = new Set();
                scoreInputs.forEach(input => { if (input.checked && input.dataset.score !== "0" && carePlanMap[input.dataset.id]) carePlanItems.add(carePlanMap[input.dataset.id]); });
                const isCtsPatient = document.getElementById('cts_cardiac_checkbox').checked;
                const k = parseFloat(document.getElementById('k_input').value);
                const mg = parseFloat(document.getElementById('mg_input').value);
                if (isCtsPatient && ((!isNaN(k) && k < 4.0) || (!isNaN(mg) && mg < 1.0))) {
                    carePlanItems.add('CTS/Cardiac Patient: Consider K+/Mg++ replacement to maintain targets (K+ >4.0, Mg++ >1.0).');
                }
                if (picsStatus === 'positive') carePlanItems.add('PICS Screening Positive: Engage with OT, Pastoral Care, or Clinical Psychology as required.');
                if (carePlanItems.size > 0) { carePlanItems.forEach(item => { summaryText += `â¢ ${item}\n`; }); } else { summaryText += `â¢ Standard ward cares.\n`; }
                const additionalNotes = document.getElementById('emrAdditionalNotes').value.trim(); if (additionalNotes) summaryText += `${additionalNotes}\n`;
                
                const devices = [];
                if(document.getElementById('device_cvc').checked) devices.push('CVC');
                if(document.getElementById('device_vascath').checked) devices.push('Vascath');
                if(document.getElementById('device_idc').checked) devices.push('IDC');
                if(document.getElementById('device_ng').checked) devices.push('NG Tube');
                if(document.getElementById('device_pacing_wire').checked) devices.push('Epicardial Pacing Wires');
                if(document.getElementById('device_other').checked && document.getElementById('device_other_text').value) devices.push(document.getElementById('device_other_text').value.trim());
                
                const drains = Array.from(drainsContainer.querySelectorAll('input[type="text"]')).map(i => i.value.trim()).filter(Boolean);
                const wounds = Array.from(woundsContainer.querySelectorAll('input[type="text"]')).map(i => i.value.trim()).filter(Boolean);
                
                let deviceText = '';
                if (devices.length > 0) deviceText += `Devices: ${devices.join(', ')}\n`;
                if (drains.length > 0) deviceText += `Drains: ${drains.join(', ')}\n`;
                if (wounds.length > 0) deviceText += `Wounds: ${wounds.join(', ')}\n`;

                if (deviceText) summaryText += `\n---\n${deviceText}`;
                
                emrSummaryEl.value = summaryText;
            }

            function handleBloodInputs() {
                const lactate = parseFloat(document.getElementById('lactate_input').value);
                document.getElementById('crit_lactate_high_checkbox').checked = lactate >= 3.5;
                document.getElementById('bloods_lactate_mid_checkbox').checked = lactate >= 2.0 && lactate < 3.5;
                const creatinine = parseFloat(document.getElementById('creatinine_input').value);
                document.getElementById('bloods_creatinine_checkbox').checked = creatinine > 200;
                const albumin = parseFloat(document.getElementById('albumin_input').value);
                document.getElementById('bloods_albumin_checkbox').checked = albumin < 25;
                const crp = parseFloat(document.getElementById('crp_input').value);
                document.getElementById('bloods_crp_checkbox').checked = crp > 100;
                const hb = parseFloat(document.getElementById('hb_input').value);
                const hb_prev = parseFloat(document.getElementById('hb_input_prev').value);
                document.getElementById('bloods_anaemia_checkbox').checked = hb < 80;
                if (!isNaN(hb) && !isNaN(hb_prev) && (hb_prev - hb > 20)) { document.getElementById('crit_hb_drop_checkbox').checked = true; }
                
                const isCtsPatient = document.getElementById('cts_cardiac_checkbox').checked;
                const k = parseFloat(document.getElementById('k_input').value);
                const mg = parseFloat(document.getElementById('mg_input').value);
                const kLowerLimit = isCtsPatient ? 4.0 : 3.5;
                const mgLowerLimit = isCtsPatient ? 1.0 : 0.7;
                if ((!isNaN(k) && (k < kLowerLimit || k > 5.0)) || (!isNaN(mg) && (mg < mgLowerLimit || mg > 1.0))) {
                    document.getElementById('bloods_electrolytes').checked = true;
                }
                calculateScore();
            }

            function addDynamicInput(container, placeholder) {
                const row = document.createElement('div');
                row.className = 'flex items-center';
                row.innerHTML = `<input type="text" placeholder="${placeholder}" class="form-input flex-grow"><button type="button" class="remove-btn">â</button>`;
                container.appendChild(row);
            }
            
            function resetForm(){
                document.querySelectorAll('input[type="text"], input[type="number"], input[type="date"], input[type="datetime-local"], textarea, select').forEach(el=>{if(el.type==='select-one'){el.selectedIndex=0}else{el.value=''}});
                document.querySelectorAll('input[type="checkbox"]').forEach(input=>input.checked=false);
                document.querySelectorAll('input[type="radio"]').forEach(rb=>{if(rb.dataset.score==="0" || rb.value==="negative"){rb.checked=true}});
                document.getElementById('airway_input').value='Patent';
                document.querySelector('input[name="concern_score"][data-score="0"]').checked=true;
                document.getElementById('nursingConcernText').style.display='none';
                drainsContainer.innerHTML=''; addDynamicInput(drainsContainer, 'Drain type & site...');
                woundsContainer.innerHTML=''; addDynamicInput(woundsContainer, 'Wound location & description...');
                picsUnableDetails.classList.add('hidden');
                document.getElementById('pics_unable_notes').value = '';
                calculateADDS();
            }
            
            // --- EVENT LISTENERS & INITIALIZATION ---
            resetButton.addEventListener('click', resetForm);
            addDrainButton.addEventListener('click', () => addDynamicInput(drainsContainer, 'Drain type & site...'));
            addWoundButton.addEventListener('click', () => addDynamicInput(woundsContainer, 'Wound location & description...'));
            drainsContainer.addEventListener('click', (e) => { if (e.target.classList.contains('remove-btn')) e.target.parentElement.remove(); });
            woundsContainer.addEventListener('click', (e) => { if (e.target.classList.contains('remove-btn')) e.target.parentElement.remove(); });
            bloodInputs.forEach(input => input.addEventListener('input', handleBloodInputs));
            scoreInputs.forEach(input => input.addEventListener('change', calculateScore));
            addsModCheckbox.addEventListener('change', () => { addsModDetails.classList.toggle('hidden', !addsModCheckbox.checked); });
            picsRadios.forEach(radio => radio.addEventListener('change', (e) => {
                picsUnableDetails.classList.toggle('hidden', e.target.value !== 'unable');
            }));
            
            // --- UNCHANGED & MINIFIED UTILITY FUNCTIONS ---
            generateSummaryButton.addEventListener('click', generateSummary);
            document.getElementById('losDays').addEventListener('input', () => { const days = parseFloat(document.getElementById('losDays').value); document.getElementById('losCheckbox').checked = days > 3; document.getElementById('losCheckbox').dispatchEvent(new Event('change')); });
            function calculateScore(){let total=0;scoreInputs.forEach(input=>{if(input.checked&&input.dataset.score!=="0"){total+=parseInt(input.dataset.score,10)}});totalScoreEl.textContent=total;updateRiskCategory(total)}
            function updateRiskCategory(score){riskCategoryEl.classList.remove('category-2','category-1','category-1-high','unsafe');let categoryKey='category-2';if(score>40){categoryKey='unsafe'}else if(score>=30){categoryKey='category-1-high'}else if(score>=12){categoryKey='category-1'}riskCategoryEl.textContent=categoryMap[categoryKey];riskCategoryEl.classList.add(categoryKey)}
            function copySummary(){emrSummaryEl.select();try{document.execCommand('copy');copySummaryButton.textContent='Copied!';setTimeout(()=>{copySummaryButton.textContent='Copy to Clipboard'},2000)}catch(err){alert('Could not copy text.')}}
            copySummaryButton.addEventListener('click', copySummary);
            function calculateADDS(){let adds=0;let met=false;const rr=parseInt(document.getElementById('rr_input').value,10),spo2=parseInt(document.getElementById('spo2_input').value,10),o2Flow=parseFloat(document.getElementById('o2_flow_input').value),o2Unit=document.getElementById('o2_unit_input').value,hr=parseInt(document.getElementById('hr_input').value,10),sbp=parseInt(document.getElementById('sbp_input').value,10),consciousness=parseInt(document.getElementById('consciousness_input').value,10),temp=parseFloat(document.getElementById('temp_input').value);if(!isNaN(rr)){if(rr>=36||rr<5)met=true;else if(rr>=30&&rr<=35)adds+=3;else if(rr>=25&&rr<=29)adds+=2;else if(rr>=21&&rr<=24)adds+=1;else if(rr>=5&&rr<=9)adds+=3}if(!isNaN(spo2)){if(spo2<=84)met=true;else if(spo2>=85&&spo2<=90)adds+=2;else if(spo2>=91&&spo2<=93)adds+=1}if(!isNaN(o2Flow)&&o2Flow>0){if(o2Unit==='lpm'){if(o2Flow>10)adds+=3;else if(o2Flow>=5&&o2Flow<=9)adds+=2;else if(o2Flow>=2&&o2Flow<=4)adds+=1}else{if(o2Flow>=40)adds+=3;else if(o2Flow>=29)adds+=2;else if(o2Flow>=21)adds+=1}}if(!isNaN(hr)){if(hr>=140||hr<30)met=true;else if(hr>=130&&hr<=139)adds+=3;else if(hr>=120&&hr<=129)adds+=2;else if(hr>=100&&hr<=119)adds+=1;else if(hr>=40&&hr<=49)adds+=1;else if(hr>=30&&hr<=39)adds+=2}if(!isNaN(sbp)){if(sbp<90)met=true;else if(sbp>=190&&sbp<=199)adds+=3;else if(sbp>=180&&sbp<=189)adds+=2;else if(sbp>=150&&sbp<=179)adds+=1;else if(sbp>=80&&sbp<=99)adds+=1;else if(sbp>=70&&sbp<=79)adds+=2}if(!isNaN(temp)){if(temp>=38.6||temp<35.1)adds+=2;else if((temp>=38&&temp<=38.5)||(temp>=35.1&&temp<=36))adds+=1}if(!isNaN(consciousness)){if(consciousness===3)met=true;else adds+=consciousness}calculatedADDSEl.textContent=met?'MET':adds;met?calculatedADDSEl.classList.add('text-red-600'):calculatedADDSEl.classList.remove('text-red-600');document.getElementById('crit_met_checkbox').checked=met;document.getElementById('crit_adds4_checkbox').checked=false;document.getElementById('adds_0_radio').checked=false;document.getElementById('adds_1-2_radio').checked=false;document.getElementById('adds_3_radio').checked=false;if(!met&&adds>=4)document.getElementById('crit_adds4_checkbox').checked=true;else if(!met&&adds===3)document.getElementById('adds_3_radio').checked=true;else if(!met&&adds>=1)document.getElementById('adds_1-2_radio').checked=true;else if(!met)document.getElementById('adds_0_radio').checked=true;calculateScore()}
            document.querySelectorAll('.vital-input').forEach(i=>i.addEventListener('input', calculateADDS));
            function handleFluidBalance(){const fbc24=parseFloat(document.getElementById('fbc_24hr_input').value),fbcTotal=parseFloat(document.getElementById('fbc_total_input').value),isSig=(!isNaN(fbc24)&&Math.abs(fbc24)>2)||(!isNaN(fbcTotal)&&Math.abs(fbcTotal)>2),isMild=(!isNaN(fbc24)&&Math.abs(fbc24)>1)||(!isNaN(fbcTotal)&&Math.abs(fbcTotal)>1);if(isSig)document.getElementById('fluid_sig_radio').checked=true;else if(isMild)document.getElementById('fluid_mild_radio').checked=true;else document.getElementById('fluid_0_radio').checked=true;calculateScore()}
            document.querySelectorAll('.fluid-input').forEach(i=>i.addEventListener('input', handleFluidBalance));

            // --- INITIALIZE PAGE ---
            resetForm();
            calculateADDS();
        });
    </script>
</body>
</html>
