<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ALERT Nursing Risk Assessment Tool</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<nav class="sidebar">
    <div class="sidebar-logo">!</div>
    <a href="#section-patient" class="nav-item" title="Patient Details">Pt</a>
    <a href="#section-risk" class="nav-item" title="Risk Assessment">Risks</a>
    <a href="#section-ae" class="nav-item" title="A-E Assessment">A-E</a>
    <a href="#section-bloods" class="nav-item" title="Bloods">Bld</a>
    <a href="#section-summary" class="nav-item" title="Summary">Sum</a>
</nav>

<header role="banner">
  <div style="flex:1;">
      <h1>ALERT <span class="logo-em">!</span> Nursing Risk Assessment Tool</h1>
      <div class="top-meta last-saved" id="lastSaved">Last saved: --:--</div>
  </div>
  <div class="header-controls">
    <button class="btn small" id="darkToggle">Dark Mode</button>
    <button class="btn danger small" id="clearDataBtnTop">Clear Data / Next Patient</button>
  </div>
</header>

<main class="container" role="main">
  
  <div id="importModal" class="modal-overlay">
      <div class="modal-content">
          <h3 style="margin:0; color:var(--accent);">Import from Previous DMR</h3>
          <p style="margin:0; color:var(--muted); font-size:0.9rem;">Paste the text from the previous ALERT DMR note below.</p>
          <textarea id="importText" class="modal-textarea" placeholder="Paste DMR note here..."></textarea>
          <div class="modal-actions">
              <button class="btn small" id="closeImport">Cancel</button>
              <button class="btn small" id="runImport" style="background:var(--accent); color:white;">Import Data</button>
          </div>
      </div>
  </div>

  <div id="section-patient" class="card">
    <div class="grid">
       <div class="col-6">
        <label>Clinician Role</label>
        <div style="display:flex; gap:8px; padding-top:6px;">
          <label style="font-weight:500"><input type="radio" name="clinicianRole" value="ALERT CNS" checked> CNS</label>
          <label style="font-weight:500"><input type="radio" name="clinicianRole" value="ALERT CN"> CN</label>
        </div>
        <div id="prevRisksBox">
            <h4>Previous Risk Factors</h4>
            <ul id="prevRisksList"></ul>
        </div>
      </div>
      
       <div class="col-6">
        <label>Review Type</label>
        <div style="display:flex; gap:8px; padding-top:6px;">
          <label style="font-weight:500"><input type="radio" name="reviewType" value="pre"> Pre-Stepdown</label>
          <label style="font-weight:500"><input type="radio" name="reviewType" value="post" checked> Post-Stepdown</label>
        </div>
        <button id="btnOpenImport" class="btn small" style="margin-top:8px; width:100%; border:1px dashed var(--accent); color:var(--accent); background:transparent;">⬇ Import data from last DMR note</button>
      </div>
      
      <div class="col-6"><label for="ptName">Patient Initials</label><input id="ptName" type="text" autocomplete="off" /></div>
      <div class="col-6"><label for="ptMrn">Last 3 digits of URN</label><input id="ptMrn" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="3" autocomplete="off" /></div>
      
      <div class="col-3"><label for="ptAge">Age</label><input id="ptAge" type="number" min="0" /></div>
      <div class="col-3"><label for="ptWeight">Weight (kg)</label><input id="ptWeight" type="number" min="0" placeholder="kg" /></div>
      
      <div class="col-6"><label for="icuLos">ICU LOS (days)</label><input id="icuLos" type="number" min="0" /></div>
      
      <div class="col-6">
        <div id="reviewTimeWrapper">
            <label for="reviewTime" style="color:var(--accent);">Time of Review</label>
            <input id="reviewTime" type="text" placeholder="HH:MM" />
        </div>
      </div>
      
      <div class="col-12">
          <div class="grid" style="row-gap:0; margin-bottom:0;">
              <div class="col-8">
                  <label for="ptWard">Ward</label>
                  <select id="ptWard">
                      <option value="" selected disabled>Select Ward...</option>
                  </select>
              </div>
              <div class="col-4">
                  <label for="ptBed">Bed</label>
                  <input id="ptBed" type="number" min="1" />
              </div>
          </div>
      </div>
      
      <div class="col-6" id="ptWardOtherWrapper" style="display:none;">
          <label for="ptWardOther">Specify Other Ward</label>
          <input id="ptWardOther" type="text" />
      </div>
      
      <div class="col-12">
          <label for="ptAdmissionReason">Reason for ICU Admission</label>
          <textarea id="ptAdmissionReason" style="min-height:60px;"></textarea>
      </div>

      <div class="col-12" id="icu_summary_wrapper" style="display:none;">
          <label for="icuSummary">ICU Course Summary</label>
          <textarea id="icuSummary" placeholder="Enter details..." style="min-height:80px;"></textarea>
      </div>
      
      <div id="stepdown_date_wrapper" style="display:contents;">
          <div class="col-6">
              <label>Stepdown Date</label>
              <input type="date" id="stepdownDate">
              <div class="quick-select-container">
                  <button type="button" class="btn small quick-select" id="btn_stepdown_today">Today</button>
                  <button type="button" class="btn small quick-select" id="btn_stepdown_yesterday">Yesterday</button>
              </div>
          </div>
          <div class="col-6">
            <label>Stepdown Time</label>
            <div class="button-group" id="stepdownTime" role="tablist">
              <button class="select-btn" data-value="Morning">Morning</button>
              <button class="select-btn" data-value="Afternoon">Afternoon</button>
              <button class="select-btn" data-value="Evening">Evening</button>
              <button class="select-btn" data-value="Night">Night</button>
            </div>
          </div>
      </div>
    </div>
  </div>

  <div id="section-risk" class="card">
    
    <div class="question-row input-box" style="padding-bottom:12px;">
        <div class="question-label">ADDS Score <span id="prev_adds" class="prev-datum"></span></div>
        <div style="display:flex; gap:12px; align-items:center;">
            <input id="adds" type="number" min="0" max="20" style="flex:1; font-weight:700; font-size:1.2rem;" />
            <button id="btnToggleCalc" class="btn small" style="background:var(--accent); color:white; height:44px;">Show Calculator</button>
        </div>
        <div id="addsCalculatorContainer" style="display:none; margin-top:12px; padding:12px; border:2px solid var(--accent); border-radius:8px; background:var(--bg);"></div>
        <div id="mScoreAlert" style="display:none; margin-top:8px; color:white; background:var(--red); padding:8px; border-radius:6px; font-weight:700; text-align:center;">MET CALL CRITERIA MET (M Score)</div>
        
        <div class="quick-select-container">
            <button type="button" class="btn small quick-select" data-target="adds" data-value="0">0</button>
            <button type="button" class="btn small quick-select" data-target="adds" data-value="1">1</button>
            <button type="button" class="btn small quick-select" data-target="adds" data-value="2">2</button>
            <button type="button" class="btn small quick-select" data-target="adds" data-value="3">3</button>
            <button type="button" class="btn small quick-select" data-target="adds" data-value="4">4</button>
        </div>
    </div>
    
    <div class="question-row input-box">
        <div class="question-label">Lactate (mmol/L) <span id="prev_lac" class="prev-datum"></span></div>
        <input id="lactate" type="number" step="0.1" min="0"/>
    </div>

    <div class="question-row input-box" id="hb_wrapper">
        <div class="grid" style="padding: 0; margin:0;">
            <div class="col-6">
                <div class="question-label">Hb (g/L) <span id="prev_hb" class="prev-datum"></span></div>
                <input id="hb" type="number" step="1" min="0"/>
            </div>
            <div class="col-6" style="align-self: end;">
                <div class="segmented-group" id="seg_hb_dropping" style="height: 44px;">
                   <button class="seg-btn" data-value="true">Hb Dropping</button>
                   <button class="seg-btn" data-value="false">Stable</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="question-row input-box" id="resp_wrapper">
      <div class="question-label bold-heading">Respiratory Concern? <span id="prev_risk_resp" class="prev-datum"></span></div>
      <div class="segmented-group" id="seg_resp_concern">
            <button class="seg-btn" data-value="true">Yes</button>
            <button class="seg-btn" data-value="false">No / RA</button>
      </div>
      
      <div id="resp_gate_content" style="display:none; margin-top:12px; border-top:1px solid var(--line); padding-top:12px;">
          <div class="grid" style="margin-bottom:10px;">
              <div class="col-12"><label class="bold-heading" style="font-size:0.9rem;">Oxygen Support</label></div>
              <div class="col-12">
                  <div class="button-group" id="oxMod" role="tablist">
                    <button class="select-btn" data-value="RA">Room Air</button>
                    <button class="select-btn" data-value="NP">Nasal Prongs</button>
                    <button class="select-btn" data-value="HFNP">HFNP</button>
                    <button class="select-btn" data-value="NIV">NIV</button>
                    <button class="select-btn" data-value="Trache">Trache / Lary</button>
                  </div>
              </div>
              <div class="col-6 npOnly" style="display:none"><label>NP Flow (L)</label><input id="npFlow" type="number" step="0.5" /></div>
              <div class="col-3 hfnpOnly" style="display:none"><label>FiO2 (%)</label><input id="hfnpFio2" type="number" step="1" /></div>
              <div class="col-3 hfnpOnly" style="display:none"><label>Flow (L)</label><input id="hfnpFlow" type="number" step="1" /></div>
              <div class="col-3 nivOnly" style="display:none;"><label>FiO2 (%)</label><input id="nivFio2" type="number" /></div>
              <div class="col-3 nivOnly" style="display:none;"><label>PEEP</label><input id="nivPeep" type="number" /></div>
              <div class="col-3 nivOnly" style="display:none;"><label>PS</label><input id="nivPs" type="number" /></div>
          </div>

          <div class="grid tracheOnly" style="display:none; padding:10px; background:var(--bg); border-radius:8px; margin-bottom:12px;">
              <div class="col-6"><div class="button-group" id="tracheType"><button class="select-btn" data-value="Tracheostomy">Tracheostomy</button><button class="select-btn" data-value="Laryngectomy">Laryngectomy</button></div></div>
              <div class="col-6"><div class="button-group" id="tracheStatus"><button class="select-btn" data-value="Stable">Stable</button><button class="select-btn" data-value="New">New/Unstable</button></div></div>
              <div class="col-12"><textarea id="trache_details_note" placeholder="Enter details..."></textarea></div>
          </div>

          <div class="grid">
              <div class="col-12"><label class="bold-heading" style="font-size:0.9rem;">Clinical Picture</label></div>
              <div class="col-12">
                  <div class="button-group" id="dyspneaConcern">
                    <button class="select-btn safe" data-value="none">No Dyspnea</button>
                    <button class="select-btn" data-value="mild">Mild</button>
                    <button class="select-btn" data-value="moderate">Moderate</button>
                    <button class="select-btn" data-value="severe">Severe</button>
                  </div>
              </div>
              <div class="col-12">
                   <div style="display:flex; flex-direction: column; gap:8px;">
                       <div class="toggle-label" id="toggle_resp_tachypnea" data-value="false" style="flex:1">Tachypnea (RR >20) <span class="state"></span></div>
                       <div class="toggle-label" id="toggle_resp_rapid_wean" data-value="false" style="flex:1">Rapid O2 Wean (<12h) <span class="state"></span></div>
                   </div>
              </div>
              
              <div class="col-12" style="margin-top:8px;">
                  <label class="question-label" style="font-size:0.9rem; margin-bottom:4px;">Historical O2 (NP ≥3L, HFNP, NIV in last 12h)?</label>
                  <div class="segmented-group" id="seg_hist_o2">
                      <button class="seg-btn" data-value="true">Yes</button>
                      <button class="seg-btn" data-value="false">No</button>
                  </div>
              </div>
              
              <div class="col-12" style="margin-top:8px;">
                  <label class="question-label" style="font-size:0.9rem; margin-bottom:4px;">Intubated in last 24h?</label>
                  <div class="segmented-group" id="seg_intubated">
                      <button class="seg-btn" data-value="true">Yes</button>
                      <button class="seg-btn" data-value="false">No</button>
                  </div>
                  <div class="sub-question-wrapper" id="sub_intubated_reason" style="margin-top:8px; display:none;">
                      <div class="button-group" id="intubatedReason">
                          <button class="select-btn small" data-value="routine">Routine/Elective</button>
                          <button class="select-btn small" data-value="concern">Complicated/Concerns</button>
                      </div>
                  </div>
              </div>
          </div>
          
          <div class="concern-note" style="display:block;">
              <textarea id="dyspneaConcern_note" placeholder="Respiratory details..."></textarea>
          </div>
      </div>
    </div>
    
    <div class="question-row input-box" id="neuro_wrapper">
      <div class="question-label bold-heading">Neurological Concern? <span id="prev_risk_neuro" class="prev-datum"></span></div>
      <div class="segmented-group" id="seg_neuro_gate">
            <button class="seg-btn" data-value="true">Yes</button>
            <button class="seg-btn" data-value="false">No</button>
      </div>
      <div id="neuro_gate_content" style="display:none; margin-top:12px; border-top:1px solid var(--line); padding-top:12px;">
          <label>Severity</label>
          <div class="button-group" id="neuroConcern">
            <button class="select-btn" data-value="mild">Mild</button>
            <button class="select-btn" data-value="moderate">Moderate</button>
            <button class="select-btn" data-value="severe">Severe</button>
          </div>
          <label style="margin-top:8px;">Type</label>
          <div class="button-group" id="neuroType">
              <button class="select-btn small" data-value="Confusion">Confusion</button>
              <button class="select-btn small" data-value="Delirium">Delirium</button>
              <button class="select-btn small" data-value="Other">Other/GCS Drop</button>
          </div>
          <div class="concern-note" style="display:block;">
                <textarea id="neuroType_note" placeholder="Neuro details / context..."></textarea>
          </div>
      </div>
    </div>
    
    <div class="question-row input-box" id="renal_wrapper">
        <div class="question-label bold-heading">Renal / Fluid Concern? <span id="prev_risk_renal" class="prev-datum"></span></div>
        <div class="segmented-group" id="seg_renal">
            <button class="seg-btn" data-value="true">Yes</button>
            <button class="seg-btn" data-value="false">No</button>
        </div>
        <div id="renal_gate_content" style="display:none; margin-top:12px; border-top:1px solid var(--line); padding-top:12px;">
             
             <label class="question-label" style="font-size:0.9rem; margin-bottom:4px;">Known CKD and Cr around baseline?</label>
             <div class="segmented-group" id="seg_renal_chronic">
                  <button class="seg-btn" data-value="true">Yes</button>
                  <button class="seg-btn" data-value="false">No</button>
             </div>

             <label style="margin-bottom:8px; margin-top:12px; font-weight:700;">Select all that apply:</label>
             
             <div class="comorbidity-group-label" style="margin-top:6px;">Renal Issues</div>
             <div class="comorbidity-grid">
                <div class="toggle-label" id="toggle_renal_oliguria" data-value="false">Oliguria (<0.5ml/kg) <span class="state"></span></div>
                <div class="toggle-label" id="toggle_renal_anuria" data-value="false">Anuria <span class="state"></span></div>
                <div class="toggle-label" id="toggle_renal_dysfunction" data-value="false">Renal Dysfunction/AKI <span class="state"></span></div>
                <div class="toggle-label" id="toggle_renal_dialysis" data-value="false">Dialysis <span class="state"></span></div>
             </div>
             
             <div id="dialysis_type_wrapper" style="display:none; margin-bottom:12px; padding:10px; background:var(--input-bg); border:1px solid var(--line); border-radius:8px;">
                 <label style="font-size:0.85rem;">Dialysis Type:</label>
                 <div class="button-group" id="dialysis_type">
                     <button class="select-btn small" data-value="new">New / Acute</button>
                     <button class="select-btn small" data-value="chronic">Long Term / Chronic</button>
                 </div>
             </div>

             <div class="comorbidity-group-label" style="margin-top:12px;">Fluid Issues</div>
             <div class="comorbidity-grid">
                 <div class="toggle-label" id="toggle_renal_fluid" data-value="false">Fluid Overload <span class="state"></span></div>
                 <div class="toggle-label" id="toggle_renal_oedema" data-value="false">Oedema <span class="state"></span></div>
                 <div class="toggle-label" id="toggle_renal_dehydrated" data-value="false">Dehydrated / Dry <span class="state"></span></div>
             </div>

             <div class="concern-note" style="display:block; margin-top:12px;">
                 <label>Renal Notes / Details:</label>
                 <textarea id="renal_note" placeholder="Enter renal details here..."></textarea>
             </div>
        </div>
    </div>

    <div class="question-row input-box" id="elec_wrapper">
      <div class="question-label bold-heading">Electrolyte Concern? <span id="prev_risk_elec" class="prev-datum"></span></div>
      <div class="segmented-group" id="seg_electrolyte_gate">
            <button class="seg-btn" data-value="true">Yes</button>
            <button class="seg-btn" data-value="false">No</button>
      </div>
      <div id="electrolyte_gate_content" style="display:none; margin-top:12px; border-top:1px solid var(--line); padding-top:12px;">
          <label>Severity</label>
          <div class="button-group" id="electrolyteConcern" role="tablist">
            <button class="select-btn" data-value="mild">Mild/moderate</button>
            <button class="select-btn" data-value="severe">Severe</button>
          </div>
           <div class="concern-note" style="display:block;">
                <label>Electrolyte Details:</label>
                <textarea id="electrolyteConcern_note" placeholder="Enter electrolyte details here..."></textarea>
          </div>
      </div>
    </div>
    
    <div class="question-row input-box" id="hac_wrapper">
        <div class="question-label bold-heading">Hospital Acquired Complication?</div>
        <div class="segmented-group" id="seg_hac">
            <button class="seg-btn" data-value="true">Yes</button>
            <button class="seg-btn" data-value="false">No</button>
        </div>
        <div class="sub-label">Did not exist upon admission e.g., HAI [HAP, VAP, CLABSI, SSI], Sepsis, New Arrythmias, Acute Renal Failure, Hemorrhage</div>
        <div id="hac_content" style="display:none; margin-top:12px;">
             <div class="concern-note" style="display:block;">
                <label>Details of Complication:</label>
                <textarea id="hac_note" placeholder="Enter HAC details..."></textarea>
             </div>
        </div>
    </div>

    <div class="question-row input-box" id="ah_wrapper">
        <div class="question-label bold-heading">Discharged after-hours? <span id="prev_risk_ah" class="prev-datum"></span></div>
        <div class="segmented-group" id="seg_after_hours">
            <button class="seg-btn" data-value="true">Yes</button>
            <button class="seg-btn" data-value="false">No</button>
        </div>
        <div class="sub-label">(No home team on ward, or reduced nursing ratio)</div>
        <div class="sub-label" style="color:var(--accent); font-weight:600;">(only score until reviewed on ward by home team)</div>
        <div id="after_hours_note_wrapper" class="concern-note" style="display:none; margin-bottom:12px;">
             <textarea id="after_hours_note" placeholder="Enter details..."></textarea>
        </div>
    </div>

    <div class="question-row input-box" id="pressor_wrapper">
        <div class="question-label bold-heading">Vasoactive Support? <span id="prev_risk_pressors" class="prev-datum"></span></div>
        <div class="segmented-group" id="seg_pressors">
            <button class="seg-btn" data-value="true">Yes</button>
            <button class="seg-btn" data-value="false">No</button>
        </div>
        
        <div id="pressor_gate_content" style="display:none; margin-top:12px; border-top:1px solid var(--line); padding-top:12px;">
            <label style="margin-bottom:8px; font-weight:700;">Select all that apply:</label>
            
            <div class="comorbidity-group-label" style="margin-top:6px;">Recent Vasoactives (Last 24h)</div>
            <div class="comorbidity-grid">
                <div class="toggle-label" id="toggle_pressor_recent_norad" data-value="false">Noradrenaline <span class="state"></span></div>
                <div class="toggle-label" id="toggle_pressor_recent_met" data-value="false">Metaraminol <span class="state"></span></div>
                <div class="toggle-label" id="toggle_pressor_recent_gtn" data-value="false">GTN <span class="state"></span></div>
                <div class="toggle-label" id="toggle_pressor_recent_dob" data-value="false">Dobutamine <span class="state"></span></div>
                <div class="toggle-label" id="toggle_pressor_recent_mid" data-value="false">Midodrine <span class="state"></span></div>
                <div class="toggle-label" id="toggle_pressor_recent_other" data-value="false">Other <span class="state"></span></div>
            </div>
            <div id="pressor_recent_other_note_wrapper" style="display:none; margin-top:8px;">
                 <input type="text" id="pressor_recent_other_note" placeholder="Specify recent vasoactive...">
            </div>

            <div style="margin-top:10px;">
                <label style="color:var(--accent);">Approx Time Ceased?</label>
                <div class="button-group">
                    <button class="btn small time-set-btn" data-time="08:00">Morning</button>
                    <button class="btn small time-set-btn" data-time="14:00">Afternoon</button>
                    <button class="btn small time-set-btn" data-time="20:00">Evening</button>
                    <button class="btn small time-set-btn" data-time="02:00">Night</button>
                </div>
                <div class="grid" style="margin-top:8px;">
                    <div class="col-6"><input type="time" id="pressor_ceased_time"></div>
                    <div class="col-6" style="display:flex; align-items:center;">
                        <span id="pressor_time_off_display" style="font-weight:700; color:var(--blue-hint); font-size:0.9rem;"></span>
                    </div>
                </div>
            </div>

            <div class="comorbidity-group-label" style="margin-top:16px;">Current Vasoactives</div>
            <div class="comorbidity-grid">
                <div class="toggle-label" id="toggle_pressor_current_mid" data-value="false">Midodrine <span class="state"></span></div>
                <div class="toggle-label" id="toggle_pressor_current_other" data-value="false">Other Vasoactive <span class="state"></span></div>
            </div>

            <div class="concern-note" style="display:block; margin-top:12px;">
                 <label>Context / Dose / Wean:</label>
                 <textarea id="pressors_note" placeholder="Enter context here..."></textarea>
            </div>
        </div>
    </div>
    
    <div class="question-row input-box" id="immobility_wrapper">
        <div class="question-label bold-heading">Immobility Concern? <span id="prev_risk_immob" class="prev-datum"></span></div>
        <div class="segmented-group" id="seg_immobility">
            <button class="seg-btn" data-value="true">Yes</button>
            <button class="seg-btn" data-value="false">No</button>
        </div>
        <div class="sub-label">(reference - cannot sit out in chair)</div>
        <div id="immobility_note_wrapper" class="concern-note" style="display:none; margin-bottom:12px;">
            <textarea id="immobility_note" placeholder="Enter details..."></textarea>
        </div>
    </div>
    
    <div class="question-row input-box" id="infection_wrapper">
        <div class="question-label bold-heading">Infection Concern? <span id="prev_risk_inf" class="prev-datum"></span></div>
        <div class="segmented-group" id="seg_infection">
            <button class="seg-btn" data-value="true">Yes</button>
            <button class="seg-btn" data-value="false">No</button>
        </div>
        <div id="infection_gate_content" style="display:none; margin-top:12px;">
            
            <label class="question-label" style="font-size:0.9rem; margin-bottom:4px;">Are the infection markers downtrending, ADDS low and the patient is on appropriate antibiotics?</label>
            <div class="segmented-group" id="seg_infection_downtrend" style="margin-bottom:12px;">
                  <button class="seg-btn" data-value="true">Yes</button>
                  <button class="seg-btn" data-value="false">No</button>
             </div>

            <div id="infectionMarkers" style="margin-bottom:12px; padding:12px; border-radius:10px; background:var(--bg)">
                <label style="margin-bottom:8px; display:block; font-weight:600;">Infection Markers</label>
                <div class="grid">
                  <div class="col-4" style="position: relative;"><div class="input-box"><label for="wcc">WCC</label><input id="wcc" type="number" step="0.1" /></div></div>
                  <div class="col-4" style="position: relative;"><div class="input-box"><label for="crp">CRP</label><input id="crp" type="number" step="1" /></div></div>
                  <div class="col-4" style="display:flex; align-items:center; justify-content:center;">
                       <div id="nlrCalc" style="font-size:1rem; font-weight:700; color:var(--muted); border:1px solid var(--line); padding:8px; border-radius:8px; width:100%; text-align:center;">NLR: --</div>
                  </div>
                  <div class="col-6"><div class="input-box"><label>Neutrophils</label><input id="neut" type="number" step="0.1" /></div></div>
                  <div class="col-6"><div class="input-box"><label>Lymphocytes</label><input id="lymph" type="number" step="0.1" /></div></div>
                </div>
            </div>
            <div class="concern-note" style="display:block;">
               <textarea id="infection_note" placeholder="Enter details..."></textarea>
            </div>
        </div>
    </div>
    
    <div class="input-box" id="comorbs_wrapper" style="margin-bottom:20px;">
        <div class="section-title">Comorbidities?</div>
        
        <div class="comorbidity-group-label">Respiratory</div>
        <div class="comorbidity-grid">
            <div class="toggle-label" id="toggle_comorb_copd" data-value="false">COPD <span class="state"></span></div>
            <div class="toggle-label" id="toggle_comorb_asthma" data-value="false">Asthma <span class="state"></span></div>
        </div>

        <div class="comorbidity-group-label">Cardiac</div>
        <div class="comorbidity-grid">
            <div class="toggle-label" id="toggle_comorb_hf" data-value="false">Active Heart Failure <span class="state"></span></div>
        </div>

        <div class="comorbidity-group-label">Renal</div>
        <div class="comorbidity-grid">
            <div class="toggle-label" id="toggle_comorb_esrd" data-value="false">ESRD <span class="state"></span></div>
            <div class="toggle-label" id="toggle_comorb_dialysis" data-value="false">Dialysis <span class="state"></span></div>
        </div>

        <div class="comorbidity-group-label">Other</div>
        <div class="comorbidity-grid">
            <div class="toggle-label" id="toggle_comorb_diabetes" data-value="false">Diabetes (Uncontrolled) <span class="state"></span></div>
            <div class="toggle-label" id="toggle_comorb_cirrhosis" data-value="false">Cirrhosis <span class="state"></span></div>
            <div class="toggle-label" id="toggle_comorb_malignancy" data-value="false">Active Malignancy <span class="state"></span></div>
            <div class="toggle-label" id="toggle_comorb_immuno" data-value="false">Immunosuppression <span class="state"></span></div>
            <div class="toggle-label" id="toggle_comorb_other" data-value="false">Other <span class="state"></span></div>
        </div>

        <div id="comorb_other_note_wrapper" class="concern-note" style="display:none; margin-top: 10px;">
            <label for="comorb_other_note">Specify other comorbidity</label>
            <textarea id="comorb_other_note" placeholder="Enter details..."></textarea>
        </div>
    </div>

    <div class="section-title" style="margin-top:20px;">Clinical Judgement Override?</div>
    <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:12px;">
      <button class="override-btn red" id="override_red">Upgrade to CAT 1</button>
      <button class="override-btn amber" id="override_amber">Upgrade to CAT 2</button>
      <button class="override-btn" id="override_clear">Clear Override</button>
    </div>
    <input type="hidden" id="override" value="none">
    <div id="override_reason_box" style="display:none;"><label>Reason for override</label><input id="overrideNote" type="text"/></div>
    
    <div style="margin-top:20px; border-top:1px solid var(--line); padding-top:12px;">
        <label style="display:flex; align-items:center; gap:8px; margin-bottom:10px; font-weight:600; cursor:pointer;">
            <input type="checkbox" id="chk_medical_rounding" style="width:auto; transform:scale(1.2);">
            Add to ALERT Medical Rounding List
        </label>
        
        <div id="chk_discharge_wrapper" style="display:none;">
            <label style="display:flex; align-items:center; gap:8px; font-weight:600; cursor:pointer; color:var(--blue-hint);">
                <input type="checkbox" id="chk_discharge_alert" style="width:auto; transform:scale(1.2);">
                Discharge from ALERT post ICU rounding list?
            </label>
        </div>

        <div id="chk_unsuitable_wrapper" style="display:none;">
             <div class="question-row input-box" id="suitability_wrapper">
               <div class="question-label" style="font-size:1.1rem; color:var(--accent);">Is patient suitable for ward stepdown?</div>
               <div class="segmented-group" id="seg_stepdown_suitable">
                   <button class="seg-btn" data-value="true">Yes</button>
                   <button class="seg-btn" data-value="false">No</button>
               </div>
                <div id="unsuitable_note_wrapper" class="concern-note" style="display:none; margin-top:12px;">
                    <textarea id="unsuitable_note" placeholder="Reason for unsuitability..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <div class="kpi" style="margin-top:24px; margin-bottom:12px; border-top:1px solid var(--line); padding-top:16px;">
        <div class="box" id="categoryBox">
            <small>Category</small>
            <h3 id="catText" class="status green">CAT 3</h3>
        </div>
        <div class="box">
            <small>Red Flags</small>
            <h3 id="redCount">0</h3>
        </div>
        <div class="box">
            <small>Amber Flags</small>
            <h3 id="amberCount">0</h3>
        </div>
    </div>

    <div id="discharge_prompt" style="display:none; text-align:center; color:var(--blue-hint); font-weight:700; margin-bottom:16px; border:2px dashed var(--blue-hint); padding:12px; border-radius:8px;">
        <div id="discharge_msg" style="margin-bottom:8px; font-size:1.1rem;"></div>
        <div style="display:flex; justify-content:center; gap:16px;">
            <button id="btn_discharge_yes" class="btn small" style="background:var(--blue-hint); color:white; border-color:var(--blue-hint);">Yes</button>
            <button id="btn_discharge_no" class="btn small">No</button>
        </div>
    </div>

    <div id="flagList" style="margin-bottom:20px; font-size:0.9rem; background:var(--input-bg); padding:10px; border-radius:8px; border:1px solid var(--line);"></div>

  </div>

  <div id="section-ae" class="accordion-wrapper" data-accordion-id="ae">
    <button class="accordion" aria-expanded="false" aria-controls="panel_ae">A-E Assessment <span class="icon" aria-hidden="true">[+]</span></button>
    <div class="panel" id="panel_ae">
      <div class="grid">
        <div class="col-12">
            <label style="display:flex; align-items:center; gap:8px; font-weight:600; cursor:pointer;">
                <input type="checkbox" id="chk_use_mods" style="width:auto; transform:scale(1.2);">
                MODS in place?
            </label>
        </div>
        <div class="col-12" id="mods_inputs" style="display:none;">
          <div class="grid">
            <div class="col-12"><div class="input-box"><label for="mods_score">MODS Score</label><input id="mods_score" type="text" placeholder="Enter score (overrides ADDS)..."/></div></div>
            <div class="col-12"><div class="input-box"><label for="mods_details">MODS Details</label><input id="mods_details" type="text" placeholder="Enter details..."/></div></div>
          </div>
        </div>
        <div class="col-12" id="adds_input_container"><div class="input-box"><label for="atoe_adds">ADDS</label><input id="atoe_adds" type="number"/></div></div>

        <div class="col-12">
            <div class="input-box">
                <label for="airway_a">A: Airway <span id="prev_airway" class="prev-datum"></span></label>
                <input id="airway_a" type="text" placeholder="" data-manual="false"/>
                <div class="quick-select-container">
                    <button type="button" class="btn small quick-select" data-stack="true" data-target="airway_a" data-value="Patent">Patent</button>
                </div>
            </div>
        </div>
        <div class="col-3">
            <div class="input-box">
                <label for="b_rr">B: RR <span id="prev_rr" class="prev-datum"></span></label>
                <div class="input-with-trend">
                    <input id="b_rr" type="text" placeholder=""/>
                    <div class="trend-buttons" id="b_rr_trend"></div>
                </div>
                <div class="quick-select-container">
                    <button type="button" class="btn small quick-select" data-stack="true" data-target="b_rr" data-value="15-20">RR 15-20</button>
                </div>
            </div>
        </div>
        <div class="col-3">
            <div class="input-box">
                <label for="b_spo2">SpO2 (%) <span id="prev_spo2" class="prev-datum"></span></label>
                <input id="b_spo2" type="text" placeholder=""/>
                <div class="quick-select-container">
                    <button type="button" class="btn small quick-select" data-stack="true" data-target="b_spo2" data-value=">94%">SpO2 >94%</button>
                </div>
            </div>
        </div>
        <div class="col-3"><div class="input-box"><label for="b_device">Oxygen Device <span id="prev_o2_dev" class="prev-datum"></span></label><input id="b_device" type="text" placeholder="" data-manual="false"/></div></div>
        
        <div class="col-3"><div class="input-box"><label for="b_wob">WOB</label><input id="b_wob" type="text" placeholder="Description..."/></div></div>

        <div class="col-3">
            <div class="input-box">
                <label for="c_hr">C: HR <span id="prev_hr" class="prev-datum"></span></label>
                <div class="input-with-trend">
                    <input id="c_hr" type="text" placeholder="Rate"/>
                    <div class="trend-buttons" id="c_hr_trend"></div>
                </div>
                <div class="quick-select-container">
                   <button type="button" class="btn small quick-select risk-trigger" data-target="c_hr_rhythm" data-value="Regular">Regular</button>
                   <button type="button" class="btn small quick-select risk-trigger" data-target="c_hr_rhythm" data-value="Irregular">Irregular</button>
                </div>
                <input id="c_hr_rhythm" type="text" placeholder="Rhythm..." style="margin-top:4px;" />
            </div>
        </div>
        <div class="col-3">
            <div class="input-box">
                <label for="c_nibp">NIBP <span id="prev_bp" class="prev-datum"></span></label>
                <div class="input-with-trend">
                    <input id="c_nibp" type="text" placeholder="SBP/DBP"/>
                    <div class="trend-buttons" id="c_nibp_trend"></div>
                </div>
            </div>
        </div>
        <div class="col-3"><div class="input-box"><label for="c_cr">Cap Refill</label><input id="c_cr" type="text" placeholder=""/></div></div>
        <div class="col-3"><div class="input-box"><label for="c_perf">Perfusion</label><input id="c_perf" type="text" placeholder=""/></div></div>

        <div class="col-4">
            <div class="input-box">
                <label for="d_alert">D: Alert? <span id="prev_alert" class="prev-datum"></span></label>
                <input id="d_alert" type="text" placeholder=""/>
                 <div class="quick-select-container">
                    <button type="button" class="btn small quick-select" data-stack="true" data-target="d_alert" data-value="Alert">Alert</button>
                    <button type="button" class="btn small quick-select" data-stack="true" data-target="d_alert" data-value="GCS 15">GCS 15</button>
                    <button type="button" class="btn small quick-select" data-stack="true" data-target="d_alert" data-value="AMT 4/4">AMT 4/4</button>
                </div>
            </div>
        </div>
        
        <div class="col-4">
            <div class="input-box">
                <label for="d_pain">Pain</label>
                <input id="d_pain" type="text" placeholder=""/>
                <div class="quick-select-container">
                    <button type="button" class="btn small quick-select" data-stack="true" data-target="d_pain" data-value="No Pain">No Pain</button>
                </div>
            </div>
        </div>
        <div class="col-4"></div>

        <div class="col-4">
            <div class="input-box">
                <label for="e_temp">E: Temp <span id="prev_temp" class="prev-datum"></span></label>
                <input id="e_temp" type="text" placeholder=""/>
                 <div class="quick-select-container">
                    <button type="button" class="btn small quick-select" data-stack="true" data-target="e_temp" data-value="Afebrile">Afebrile</button>
                </div>
            </div>
        </div>
        <div class="col-4"><div class="input-box"><label for="e_bsl">BSL</label><input id="e_bsl" type="text" placeholder=""/></div></div>
        
        <div class="col-4">
            <div class="input-box">
                <label for="e_uop">UOP</label>
                <div style="display:flex; align-items:center; gap:4px;">
                    <input id="e_uop" type="text" placeholder="ml/hr"/>
                    <div id="target_uop_display" style="font-size:0.75rem; color:var(--blue-hint); font-weight:700; white-space:nowrap; display:none;">Target: >--</div>
                </div>
                <div class="quick-select-container">
                    <button type="button" class="btn small quick-select safe-trigger" data-stack="true" data-target="e_uop" data-value="WNL">WNL</button>
                    <button type="button" class="btn small quick-select safe-trigger" data-stack="true" data-target="e_uop" data-value=">0.5ml/kg/hr">>0.5ml/kg</button>
                    <button type="button" class="btn small quick-select risk-trigger" data-stack="true" data-risk="renal" data-target="e_uop" data-value="Oliguric">Oliguric</button>
                    <button type="button" class="btn small quick-select risk-trigger" data-stack="true" data-risk="renal" data-target="e_uop" data-value="Anuric">Anuric</button>
                    <button type="button" class="btn small quick-select risk-trigger" data-stack="true" data-risk="renal" data-target="e_uop" data-value="<0.5ml/kg/hr"><0.5ml/kg</button>
                </div>
            </div>
        </div>

        <div class="col-12"><hr></div>
        
        <div class="col-12">
            <div class="input-box">
                <label for="ae_mobility">Mobility/MSK</label>
                <input id="ae_mobility" type="text" placeholder="Current mobility level"/>
                <div class="quick-select-container">
                    <button type="button" class="btn small quick-select" data-stack="true" data-target="ae_mobility" data-value="Independent">Independent</button>
                    <button type="button" class="btn small quick-select" data-stack="true" data-target="ae_mobility" data-value="1x Assist">1x Assist</button>
                    <button type="button" class="btn small quick-select" data-stack="true" data-target="ae_mobility" data-value="2x Assist">2x Assist</button>
                    <button type="button" class="btn small quick-select" data-stack="true" data-target="ae_mobility" data-value="RIB">RIB</button>
                </div>
            </div>
        </div>
        
        <div class="col-12">
            <div class="input-box">
                <label for="ae_diet">Diet</label>
                <input id="ae_diet" type="text" placeholder="Current diet/fluids"/>
                <div class="quick-select-container">
                    <button type="button" class="btn small quick-select" data-stack="true" data-target="ae_diet" data-value="Normal">Normal</button>
                    <button type="button" class="btn small quick-select" data-stack="true" data-target="ae_diet" data-value="Clear Fluids">Clear Fluids</button>
                    <button type="button" class="btn small quick-select" data-stack="true" data-target="ae_diet" data-value="Nourishing Fluids">Nourishing Fluids</button>
                    <button type="button" class="btn small quick-select" data-stack="true" data-target="ae_diet" data-value="NBM">NBM</button>
                    <button type="button" class="btn small quick-select" data-stack="true" data-target="ae_diet" data-value="TPN">TPN</button>
                    <button type="button" class="btn small quick-select" data-stack="true" data-target="ae_diet" data-value="PPN">PPN</button>
                    <button type="button" class="btn small quick-select" data-stack="true" data-target="ae_diet" data-value="NG Feed">NG Feed</button>
                </div>
            </div>
        </div>
        
        <div class="col-12">
            <div class="input-box">
                <label for="ae_bowels">Bowels</label>
                <input id="ae_bowels" type="text" placeholder="Note details..."/>
                <div class="quick-select-container">
                    <button type="button" class="btn small quick-select" id="btn_bno">BNO</button>
                    <button type="button" class="btn small quick-select" id="btn_bo">BO</button>
                </div>
                <div id="bowel_date_wrapper" style="display:none; margin-top:8px;">
                    <div style="display:flex; gap:8px; align-items:flex-end;">
                        <div style="flex:0 0 auto;">
                            <label id="bowel_date_label" style="font-size:0.8rem; color:var(--accent);">Date</label>
                            <input type="date" id="bowel_date" style="padding:6px; font-size:0.9rem;">
                            <div class="quick-select-container">
                                <button type="button" class="btn small quick-select" id="btn_bowel_today">Today</button>
                                <button type="button" class="btn small quick-select" id="btn_bowel_yesterday">Yesterday</button>
                            </div>
                        </div>
                        <div id="aperients_wrapper" style="display:none; flex:1; padding-bottom:8px;">
                             <label style="display:flex; align-items:center; gap:6px; font-weight:600; cursor:pointer; font-size:0.9rem;">
                                <input type="checkbox" id="chk_aperients" style="width:auto; transform:scale(1.1);">
                                Aperients charted?
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
      </div>
    </div>
  </div>

  <div id="section-bloods" class="accordion-wrapper" data-accordion-id="bloods">
    <button class="accordion" aria-expanded="false" aria-controls="panel_bloods">Bloods <span class="icon" aria-hidden="true">[+]</span></button>
    <div class="panel" id="panel_bloods">
      
      <button id="btnUseSameBloods" class="btn small" style="width:100%; margin-bottom:12px; border:1px dashed var(--accent); color:var(--accent); background:transparent;">
          ⟲ Use same results as last review (no new bloods)
      </button>

      <div class="bloods-grid">
        <div class="input-box blood-item"><label for="bl_lac_review">Lac <span id="prev_bl_lac_review" class="prev-datum"></span></label><input id="bl_lac_review" type="number" step="0.1"/><div class="trend-buttons" id="bl_lac_review_trend"></div><span class="range-subtext">(0.5-2.0)</span></div>
        <div class="input-box blood-item"><label for="bl_hb">Hb <span id="prev_bl_hb" class="prev-datum"></span></label><input id="bl_hb" type="number"/><div class="trend-buttons" id="bl_hb_trend"></div><span class="range-subtext">(115-165)</span></div>
        <div class="input-box blood-item"><label for="bl_wcc">WCC <span id="prev_bl_wcc" class="prev-datum"></span></label><input id="bl_wcc" type="number" step="0.1"/><div class="trend-buttons" id="bl_wcc_trend"></div><span class="range-subtext">(4-11)</span></div>
        <div class="input-box blood-item"><label for="bl_crp">CRP <span id="prev_bl_crp" class="prev-datum"></span></label><input id="bl_crp" type="number"/><div class="trend-buttons" id="bl_crp_trend"></div><span class="range-subtext">(<5)</span></div>
        <div class="input-box blood-item"><label for="bl_cr_review">Cr <span id="prev_bl_cr_review" class="prev-datum"></span></label><input id="bl_cr_review" type="number"/><div class="trend-buttons" id="bl_cr_review_trend"></div><span class="range-subtext">(50-98)</span></div>
        <div class="input-box blood-item"><label for="bl_k">K <span id="prev_bl_k" class="prev-datum"></span></label><input id="bl_k" type="number" step="0.1"/><div class="trend-buttons" id="bl_k_trend"></div><span class="range-subtext">(3.5-5.2)</span></div>
        <div class="input-box blood-item"><label for="bl_na">Na <span id="prev_bl_na" class="prev-datum"></span></label><input id="bl_na" type="number" step="1"/><div class="trend-buttons" id="bl_na_trend"></div><span class="range-subtext">(135-145)</span></div>
        <div class="input-box blood-item"><label for="bl_mg">Mg <span id="prev_bl_mg" class="prev-datum"></span></label><input id="bl_mg" type="number" step="0.1"/><div class="trend-buttons" id="bl_mg_trend"></div><span class="range-subtext">(0.7-1.1)</span></div>
        <div class="input-box blood-item"><label for="bl_phos">PO4 <span id="prev_bl_phos" class="prev-datum"></span></label><input id="bl_phos" type="number" step="0.1"/><div class="trend-buttons" id="bl_phos_trend"></div><span class="range-subtext">(0.8-1.5)</span></div>
        <div class="input-box blood-item"><label for="bl_plts">Plts <span id="prev_bl_plts" class="prev-datum"></span></label><input id="bl_plts" type="number"/><div class="trend-buttons" id="bl_plts_trend"></div><span class="range-subtext">(150-400)</span></div>
        <div class="input-box blood-item"><label for="bl_alb">Alb <span id="prev_bl_alb" class="prev-datum"></span></label><input id="bl_alb" type="number"/><div class="trend-buttons" id="bl_alb_trend"></div><span class="range-subtext">(35-50)</span></div>
        <div class="input-box blood-item"><label for="bl_neut">Neut <span id="prev_bl_neut" class="prev-datum"></span></label><input id="bl_neut" type="number" step="0.1"/><div class="trend-buttons" id="bl_neut_trend"></div><span class="range-subtext">(1.5-7.5)</span></div>
        <div class="input-box blood-item"><label for="bl_lymph">Lymph <span id="prev_bl_lymph" class="prev-datum"></span></label><input id="bl_lymph" type="number" step="0.1"/><div class="trend-buttons" id="bl_lymph_trend"></div><span class="range-subtext">(1.0-4.0)</span></div>
        
        <div class="input-box blood-item"><label for="bl_bili">Bili <span id="prev_bl_bili" class="prev-datum"></span></label><input id="bl_bili" type="number"/><div class="trend-buttons" id="bl_bili_trend"></div><span class="range-subtext">(<20)</span></div>
        <div class="input-box blood-item"><label for="bl_alt">ALT <span id="prev_bl_alt" class="prev-datum"></span></label><input id="bl_alt" type="number"/><div class="trend-buttons" id="bl_alt_trend"></div><span class="range-subtext">(<40)</span></div>
        <div class="input-box blood-item"><label for="bl_inr">INR <span id="prev_bl_inr" class="prev-datum"></span></label><input id="bl_inr" type="number" step="0.1"/><div class="trend-buttons" id="bl_inr_trend"></div><span class="range-subtext">(0.9-1.2)</span></div>
        <div class="input-box blood-item"><label for="bl_aptt">APTT <span id="prev_bl_aptt" class="prev-datum"></span></label><input id="bl_aptt" type="number"/><div class="trend-buttons" id="bl_aptt_trend"></div><span class="range-subtext">(25-38)</span></div>
      </div>
      
      <div class="grid" style="margin-top:12px;">
          <div class="col-12">
             <label class="question-label" style="font-size:0.9rem; margin-bottom:4px;">Are the infection markers downtrending, ADDS low and the patient is on appropriate antibiotics?</label>
             <div class="segmented-group" id="seg_infection_downtrend_bloods">
                  <button class="seg-btn" data-value="true">Yes</button>
                  <button class="seg-btn" data-value="false">No</button>
             </div>
          </div>
           <div class="col-12" style="margin-top:8px;">
             <label class="question-label" style="font-size:0.9rem; margin-bottom:4px;">Known CKD and Cr around baseline?</label>
             <div class="segmented-group" id="seg_renal_chronic_bloods">
                  <button class="seg-btn" data-value="true">Yes</button>
                  <button class="seg-btn" data-value="false">No</button>
             </div>
          </div>
      </div>

      <div class="grid" id="infusions_wrapper" style="display:none; margin-top: 12px; row-gap: 8px;">
          <div class="col-12"><div class="input-box"><label for="infusions_note">Infusions</label><input id="infusions_note" type="text" placeholder="Enter details..."/></div></div>
      </div>

      <div style="margin-top:12px" class="grid">
        <div class="col-12"><div class="input-box"><label>Electrolyte Plan</label><input id="elec_replace_note" type="text" placeholder="Replacement plan..."/></div></div>
        <div class="col-12" style="margin-top:8px">
             <div class="segmented-group" id="seg_new_bloods_ordered">
                <button class="seg-btn" style="flex:3; text-align:left; padding-left:12px; pointer-events:none;">New bloods ordered?</button>
                <button class="seg-btn" data-value="true">Yes</button>
                <button class="seg-btn" data-value="false">No</button>
            </div>
        </div>
      </div>
    </div>
  </div>

  <div class="accordion-wrapper" data-accordion-id="devices">
    <button class="accordion" aria-expanded="false" aria-controls="panel_devices">Lines, Drains & Wounds <span class="icon" aria-hidden="true">[+]</span></button>
    <div class="panel" id="panel_devices" style="display:flex; flex-direction:column; gap: 12px;">
       <div id="devices-container"></div>
       <div class="button-group" style="justify-content: flex-start; flex-wrap: wrap;">
           <button class="btn small" data-device-type="CVC">+ Add CVC</button>
           <button class="btn small" data-device-type="PICC">+ Add PICC</button>
           <button class="btn small" data-device-type="Other CVAD">+ Add Other CVAD</button>
           <button class="btn small" data-device-type="PIVC">+ Add PIVC</button>
           <button class="btn small" data-device-type="Arterial Line">+ Add Arterial Line</button>
           <button class="btn small" data-device-type="Enteral Tube">+ Add Enteral Tube</button>
           <button class="btn small" data-device-type="IDC">+ Add IDC</button>
           <button class="btn small" data-device-type="Pacing Wire">+ Add Pacing Wire</button>
           <button class="btn small" data-device-type="Drain">+ Add Drain</button>
           <button class="btn small" data-device-type="Wound">+ Add Wound</button>
           <button class="btn small" data-device-type="Other Device">+ Add Other Device</button>
       </div>
    </div>
  </div>

  <div id="section-context" class="accordion-wrapper" data-accordion-id="context">
    <button class="accordion" aria-expanded="false" aria-controls="panel_context">Other Factors <span class="icon" aria-hidden="true">[+]</span></button>
    <div class="panel" id="panel_context">
        <div class="devices-subtitle">▶ Goals of Care (GOC)</div>
        <div class="devices-input-group">
            <textarea id="goc_note" placeholder="Enter details..."></textarea>
        </div>

        <div class="devices-subtitle">▶ Allergies</div>
        <div class="devices-input-group">
            <textarea id="allergies_note" placeholder="Enter details..."></textarea>
        </div>
        
        <div class="devices-subtitle">▶ Significant Past Medical History (PMH)</div>
        <div id="selected_comorbs_display" style="font-size:0.85rem; color:var(--accent); font-weight:600; margin-bottom:4px; display:none;"></div>
        <div class="devices-input-group">
            <textarea id="pmh_note" placeholder="Enter additional PMH here..."></textarea>
        </div>

        <div class="devices-subtitle">▶ PICS Assessment</div>
        <div class="devices-input-group">
            <textarea id="pics_note" placeholder="Enter details..."></textarea>
        </div>

        <div class="devices-subtitle">▶ Other</div>
        <div class="devices-input-group">
            <textarea id="context_other_note" placeholder="Enter details..."></textarea>
        </div>
    </div>
  </div>

  <div id="section-summary" class="card">
    <div class="section-title">Auto-Generated Summary</div>
    
    <div id="manual_edit_warning" style="display:none; background:#fff3cd; color:#856404; padding:8px; border-radius:6px; font-size:0.9rem; margin-bottom:8px; border:1px solid #ffeeba; align-items:center; justify-content:space-between;">
        <span><strong>Note:</strong> You have edited the text manually. Auto-updates paused.</span>
        <button id="btn_force_update" class="btn small" style="background:#856404; color:white; border:none; margin-left:8px;">Update Anyway</button>
    </div>

    <textarea id="summary" placeholder="Summary will auto-generate here..."></textarea>
    <button id="btnCopySummaryMain" class="btn" style="width:100%; margin-top:8px; background:var(--input-bg);">Copy to DMR (Clipboard)</button>
    
    <div id="completeness_nudge" style="margin-top:8px; margin-bottom:8px; font-size:0.9rem; color:var(--muted); font-weight:600; text-align:left;"></div>
  </div>
  
  <div style="text-align:center; color: var(--muted); font-weight: 600; margin: 24px 0; letter-spacing: 1px;">- END ASSESSMENT -</div>
</main>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<footer role="contentinfo">
  <div class="footer-item"><strong>Patient:</strong> <span id="footerName">--</span></div>
  <div class="footer-item"><strong>Room:</strong> <span id="footerLocation">--</span></div>
  <div class="footer-item reason"><strong>Reason:</strong> <span id="footerAdmission">--</span></div>
  <div id="footerScore" class="footer-score tag green">CAT 3</div>
  <div class="footer-buttons">
      <button class="btn" id="footerCopy">
          <span class="desktop-text">Copy to Clipboard</span>
          <span class="mobile-text">Copy</span>
      </button>
      <button class="btn danger" id="footerClear">
          <span class="desktop-text">Clear Data / Next Patient</span>
          <span class="mobile-text">Clear</span>
      </button>
      <button id="btnRedcap" class="btn" style="background-color:#d9534f; color:white; border:none; margin-left:auto;">
          <span class="desktop-text">Copy to REDCap</span>
          <span class="mobile-text">REDCap</span>
      </button>
  </div>
</footer>

<script src="script.js"></script>
<script src="plugins/redcap.js"></script>
<script src="plugins/adds_calc.js"></script>
<script src="plugins/importer.js"></script>
</body>
</html>
