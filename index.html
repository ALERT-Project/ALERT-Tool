<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive ALERT Nursing Risk Assessment Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F0F9F9; /* A very light teal background */
        }
        .fail-text { color: #E53E3E; }
        .pass-text { color: #38A169; }
        .category-2 { background-color: #4FD1C5; color: #134E4A; } /* Light Teal */
        .category-1 { background-color: #F6E05E; color: #1A202C; } /* Yellow */
        .unsafe { background-color: #FC8181; color: #1A202C; } /* Red */
        .hard-stop-active {
            background-color: #FED7D7;
            border-color: #E53E3E;
        }
        .header-gradient {
            background: linear-gradient(to right, #0D9488, #0F766E); /* Dark Teal Gradient */
        }
        .module-header {
            color: #0F766E; /* Dark Teal */
        }
        .module-border {
            border-color: #99F6E4; /* Light Teal */
        }
        .final-score-bg {
            background-color: #134E4A; /* Very Dark Teal */
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">

    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg mb-6 overflow-hidden">
            <div class="header-gradient p-6 flex items-center justify-center text-white">
                 <div class="bg-white/20 rounded-full p-2 mr-4">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                </div>
                <h1 class="text-2xl sm:text-3xl font-bold">ALERT Nursing Risk Assessment Tool</h1>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 text-sm">
                    <div>
                        <label for="patientInitials" class="block font-medium text-gray-600">Patient Initials:</label>
                        <input type="text" id="patientInitials" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500">
                    </div>
                    <div>
                        <label for="urnLast4" class="block font-medium text-gray-600">Last 4 Digits of URN:</label>
                        <input type="text" id="urnLast4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500">
                    </div>
                     <div>
                        <label for="losDays" class="block font-medium text-gray-600">ICU LOS (days):</label>
                        <input type="number" id="losDays" min="0" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500">
                    </div>
                    <div class="sm:col-span-2 lg:col-span-3">
                         <label for="admissionReason" class="block font-medium text-gray-600">Reason for ICU Admission:</label>
                        <textarea id="admissionReason" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500"></textarea>
                    </div>
                     <div class="lg:col-span-1">
                        <label for="dischargeDate" class="block font-medium text-gray-600">Discharge Date:</label>
                        <input type="date" id="dischargeDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500">
                    </div>
                    <div class="sm:col-span-2 lg:col-span-2">
                        <label for="assessmentDateTime" class="block font-medium text-gray-600">Assessment Date & Time:</label>
                        <input type="datetime-local" id="assessmentDateTime" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500">
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 1: Hard Stop Checklist -->
        <div id="hardStopSection" class="bg-white rounded-xl shadow-lg mb-6 p-6">
            <h2 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">STEP 1: "HARD STOP" CHECKLIST</h2>
            <p class="text-sm text-gray-600 mb-4">If any criterion is a FAIL, STOP. Discharge is paused for mandatory senior clinician review.</p>
            <div class="space-y-3">
                <!-- Hard Stop Items -->
                <div class="flex justify-between items-center p-3 rounded-md border border-gray-200">
                    <span class="font-medium text-gray-700">Currently in MET criteria?</span>
                    <div class="flex items-center space-x-3">
                        <label class="pass-text font-semibold"><input type="radio" name="hardStop_met" class="hard-stop-radio" value="pass" checked> PASS</label>
                        <label class="fail-text font-semibold"><input type="radio" name="hardStop_met" class="hard-stop-radio" value="fail"> FAIL</label>
                    </div>
                </div>
                <div class="flex justify-between items-center p-3 rounded-md border border-gray-200">
                    <span class="font-medium text-gray-700">ADDS Score ≥ 4?</span>
                    <div class="flex items-center space-x-3">
                        <label class="pass-text font-semibold"><input type="radio" name="hardStop_adds" class="hard-stop-radio" value="pass" checked> PASS</label>
                        <label class="fail-text font-semibold"><input type="radio" name="hardStop_adds" class="hard-stop-radio" value="fail"> FAIL</label>
                    </div>
                </div>
                <div class="flex justify-between items-center p-3 rounded-md border border-gray-200">
                    <span class="font-medium text-gray-700">Lactate ≥ 3.5 mmol/L?</span>
                    <div class="flex items-center space-x-3">
                        <label class="pass-text font-semibold"><input type="radio" name="hardStop_lactate" class="hard-stop-radio" value="pass" checked> PASS</label>
                        <label class="fail-text font-semibold"><input type="radio" name="hardStop_lactate" class="hard-stop-radio" value="fail"> FAIL</label>
                    </div>
                </div>
                <div class="flex justify-between items-center p-3 rounded-md border border-gray-200">
                    <span class="font-medium text-gray-700">Unstable Atrial Fibrillation?</span>
                    <div class="flex items-center space-x-3">
                        <label class="pass-text font-semibold"><input type="radio" name="hardStop_af" class="hard-stop-radio" value="pass" checked> PASS</label>
                        <label class="fail-text font-semibold"><input type="radio" name="hardStop_af" class="hard-stop-radio" value="fail"> FAIL</label>
                    </div>
                </div>
                <div class="flex justify-between items-center p-3 rounded-md border border-gray-200">
                    <span class="font-medium text-gray-700">Increasing Respiratory Support in last 12h?</span>
                    <div class="flex items-center space-x-3">
                        <label class="pass-text font-semibold"><input type="radio" name="hardStop_resp" class="hard-stop-radio" value="pass" checked> PASS</label>
                        <label class="fail-text font-semibold"><input type="radio" name="hardStop_resp" class="hard-stop-radio" value="fail"> FAIL</label>
                    </div>
                </div>
                <div class="flex justify-between items-center p-3 rounded-md border border-gray-200">
                    <span class="font-medium text-gray-700">Falling Hb / Active Bleeding?</span>
                    <div class="flex items-center space-x-3">
                        <label class="pass-text font-semibold"><input type="radio" name="hardStop_hb" class="hard-stop-radio" value="pass" checked> PASS</label>
                        <label class="fail-text font-semibold"><input type="radio" name="hardStop_hb" class="hard-stop-radio" value="fail"> FAIL</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scoring section container -->
        <div id="scoringContainer">
            <!-- Step 2: Risk Scoring Assessment -->
            <div class="bg-white rounded-xl shadow-lg mb-6 p-6">
                <h2 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">STEP 2: RISK SCORING ASSESSMENT</h2>
                <div class="space-y-6">
                    <!-- Scoring Modules -->
                    <!-- Module A -->
                    <div>
                        <h3 class="font-semibold text-lg module-header mb-2">A: ADDS</h3>
                        <div class="space-y-2 pl-4 border-l-2 module-border">
                            <label class="flex items-center"><input type="radio" name="adds_score" class="score-input" data-score="0" checked> <span class="ml-2">Current ADDS Score 0 (+0)</span></label>
                            <label class="flex items-center"><input type="radio" name="adds_score" class="score-input" data-score="1"> <span class="ml-2">Current ADDS Score 1-2 (+1)</span></label>
                            <label class="flex items-center"><input type="radio" name="adds_score" class="score-input" data-score="5"> <span class="ml-2">Current ADDS Score 3 (+5)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="5"> <span class="ml-2">Worsening Trend (last 12-24h) (+5)</span></label>
                        </div>
                    </div>
                    <!-- Module B -->
                    <div>
                        <h3 class="font-semibold text-lg module-header mb-2">B: Bloods</h3>
                        <div class="space-y-2 pl-4 border-l-2 module-border">
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="4"> <span class="ml-2">Abnormal Electrolytes (K+, Mg++, Na+, Phos) (+4)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="4"> <span class="ml-2">Lactate 2.0 - 3.4 (+4)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="4"> <span class="ml-2">Creatinine >200 µmol/L (+4)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="3"> <span class="ml-2">Albumin <25 g/L (+3)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="3"> <span class="ml-2">CRP >100 mg/L (static/rising) (+3)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="3"> <span class="ml-2">Anaemia (Hb < 80 g/L) (+3)</span></label>
                        </div>
                    </div>
                    <!-- Module C -->
                    <div>
                        <h3 class="font-semibold text-lg module-header mb-2">C: Clinical</h3>
                        <div class="space-y-2 pl-4 border-l-2 module-border">
                            <label class="flex items-center"><input type="radio" name="pain_score" class="score-input" data-score="0" checked> <span class="ml-2 text-gray-500">Pain: None / Well Controlled</span></label>
                            <label class="flex items-center"><input type="radio" name="pain_score" class="score-input" data-score="3"> <span class="ml-2">Pain: Requires regular IV/potent analgesia (+3)</span></label>
                            <label class="flex items-center"><input type="radio" name="pain_score" class="score-input" data-score="5"> <span class="ml-2">Pain: Poorly controlled / PCA (+5)</span></label>
                             <label class="flex items-center"><input type="radio" name="fluid_status_score" class="score-input" data-score="0" checked> <span class="ml-2 text-gray-500">Fluid Status: Euvolaemic</span></label>
                            <label class="flex items-center"><input type="radio" name="fluid_status_score" class="score-input" data-score="2"> <span class="ml-2">Fluid Status: Mildly Dry/Oedematous (+2)</span></label>
                            <label class="flex items-center"><input type="radio" name="fluid_status_score" class="score-input" data-score="4"> <span class="ml-2">Fluid Status: Significantly Dry/Oedematous (+4)</span></label>
                            <label class="flex items-center"><input type="radio" name="diet_score" class="score-input" data-score="0" checked> <span class="ml-2 text-gray-500">Diet: Eating & Drinking Normally</span></label>
                            <label class="flex items-center"><input type="radio" name="diet_score" class="score-input" data-score="2"> <span class="ml-2">Diet: Supplements / Modified (+2)</span></label>
                            <label class="flex items-center"><input type="radio" name="diet_score" class="score-input" data-score="4"> <span class="ml-2">Diet: NBM / NG / TPN (+4)</span></label>
                            <label class="flex items-center"><input type="radio" name="delirium_score" class="score-input" data-score="0" checked> <span class="ml-2 text-gray-500">Delirium: None</span></label>
                            <label class="flex items-center"><input type="radio" name="delirium_score" class="score-input" data-score="4"> <span class="ml-2">Delirium: Mild / Subsyndromal (+4)</span></label>
                            <label class="flex items-center"><input type="radio" name="delirium_score" class="score-input" data-score="8"> <span class="ml-2">Delirium: Moderate to Severe (+8)</span></label>
                            <label class="flex items-center"><input type="radio" name="mobility_score" class="score-input" data-score="0" checked> <span class="ml-2 text-gray-500">Mobility: At Baseline</span></label>
                            <label class="flex items-center"><input type="radio" name="mobility_score" class="score-input" data-score="2"> <span class="ml-2">Mobility: Assisted (+2)</span></label>
                            <label class="flex items-center"><input type="radio" name="mobility_score" class="score-input" data-score="5"> <span class="ml-2">Mobility: Bed-bound (+5)</span></label>
                            <label class="flex items-center"><input type="radio" name="airway_score" class="score-input" data-score="0" checked> <span class="ml-2 text-gray-500">Airway Clearance: Good/Effective Cough</span></label>
                            <label class="flex items-center"><input type="radio" name="airway_score" class="score-input" data-score="4"> <span class="ml-2">Airway Clearance: Weak cough (+4)</span></label>
                            <div class="pt-2">
                                <label class="flex items-center"><input type="radio" name="concern_score" class="score-input" data-score="0" checked> <span class="ml-2 text-gray-500">Nursing Concern: None</span></label>
                                <label class="flex items-center"><input type="radio" name="concern_score" class="score-input" data-score="5"> <span class="ml-2">Nursing Concern Present (+5)</span></label>
                                <textarea id="nursingConcernText" class="mt-2 ml-6 w-full rounded-md border-gray-300 shadow-sm text-sm" rows="2" placeholder="Specify concern..." style="display: none;"></textarea>
                            </div>
                            <label class="flex items-center"><input type="radio" name="lines_score" class="score-input" data-score="0" checked> <span class="ml-2 text-gray-500">Lines: None / PIVC only</span></label>
                            <label class="flex items-center"><input type="radio" name="lines_score" class="score-input" data-score="5"> <span class="ml-2">Lines: CVC or Vascath (+5)</span></label>
                        </div>
                    </div>
                     <!-- Module D -->
                    <div>
                        <h3 class="font-semibold text-lg module-header mb-2">D: Systemic</h3>
                        <div class="space-y-2 pl-4 border-l-2 module-border">
                            <label class="flex items-center"><input type="checkbox" id="losCheckbox" class="score-input" data-score="4"> <span class="ml-2">LOS > 72 hours (+4)</span></label>
                            <label class="flex items-center"><input type="radio" name="frailty_score" class="score-input" data-score="0" checked> <span class="ml-2 text-gray-500">Frailty: Not Frail</span></label>
                            <label class="flex items-center"><input type="radio" name="frailty_score" class="score-input" data-score="2"> <span class="ml-2">Frailty: Mild (+2)</span></label>
                            <label class="flex items-center"><input type="radio" name="frailty_score" class="score-input" data-score="4"> <span class="ml-2">Frailty: Mod-Severe (+4)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="4"> <span class="ml-2">≥3 chronic comorbidities (e.g. IHD, COPD, T2DM) (+4)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="3"> <span class="ml-2">Out-of-Hours Discharge (+3)</span></label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

         <!-- Clinical Details for EMR -->
        <div class="bg-white rounded-xl shadow-lg mb-6 p-6">
            <h2 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">Clinical Details for EMR</h2>
            <div class="space-y-4">
                <div>
                    <h3 class="font-medium text-gray-700">Devices in situ:</h3>
                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-2 mt-2">
                        <div class="flex items-center">
                            <input type="checkbox" id="device_pivc" class="device-checkbox" value="PIVC">
                            <label for="device_pivc" class="ml-2">PIVC (x</label>
                            <input type="number" id="pivc_count" min="1" class="w-12 ml-1 rounded-md border-gray-300 shadow-sm text-sm">)
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="device_drain" class="device-checkbox" value="Drain">
                            <label for="device_drain" class="ml-2">Drain (x</label>
                            <input type="number" id="drain_count" min="1" class="w-12 ml-1 rounded-md border-gray-300 shadow-sm text-sm">)
                        </div>
                        <label class="flex items-center"><input type="checkbox" id="device_cvc" class="device-checkbox" value="CVC/Vascath"> <span class="ml-2">CVC/Vascath</span></label>
                        <label class="flex items-center"><input type="checkbox" class="device-checkbox" value="Pacing Wires"> <span class="ml-2">Pacing Wires</span></label>
                        <label class="flex items-center"><input type="checkbox" class="device-checkbox" value="IDC"> <span class="ml-2">IDC</span></label>
                        <label class="flex items-center"><input type="checkbox" class="device-checkbox" value="NG Tube"> <span class="ml-2">NG Tube</span></label>
                        <label class="flex items-center"><input type="checkbox" class="device-checkbox" value="PEG"> <span class="ml-2">PEG</span></label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 3: Final Review -->
        <div class="bg-white rounded-xl shadow-lg mb-6 p-6">
            <h2 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">STEP 3: FINAL REVIEW & STRATIFICATION</h2>
            <div class="space-y-4">
                <div class="bg-teal-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-lg text-teal-800 mb-2">Mandatory Action for CTS or Cardiac History Patients</h3>
                    <div class="flex items-center">
                        <input id="mandatory_action_checkbox" type="checkbox" class="h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500">
                        <label for="mandatory_action_checkbox" class="ml-3 block text-sm font-medium text-gray-700">
                           Confirm plan is in place to target <strong>K+ ~4.0</strong> and <strong>Mg++ ~1.0</strong>.
                        </label>
                    </div>
                </div>
                <div class="final-score-bg text-white rounded-xl shadow-lg p-6">
                     <div class="flex flex-col sm:flex-row justify-between items-center text-center">
                        <div class="mb-4 sm:mb-0">
                            <span class="text-lg font-medium text-gray-400">TOTAL SCORE</span>
                            <div id="totalScore" class="text-5xl font-bold">0</div>
                        </div>
                        <div class="w-full sm:w-auto">
                            <span class="text-lg font-medium text-gray-400">FINAL CATEGORY & ACTION</span>
                            <div id="riskCategory" class="text-xl font-bold p-3 rounded-md mt-1 transition-all duration-300">
                                Category 2: Standard follow-up
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- EMR Summary Section -->
        <div class="bg-white rounded-xl shadow-lg mt-6 p-6">
            <h2 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">EMR Summary Generator</h2>
            <div class="space-y-3 mb-4">
                <div>
                    <label class="block font-medium text-gray-600 text-sm">Review Type:</label>
                    <div class="flex items-center space-x-4 mt-1">
                        <label class="flex items-center"><input type="radio" name="review_type" value="pre" checked> <span class="ml-2">Pre ICU Stepdown Review</span></label>
                        <label class="flex items-center"><input type="radio" name="review_type" value="post"> <span class="ml-2">Post ICU Review on Ward - Day:</span></label>
                        <input type="number" id="reviewDay" min="1" class="ml-1 w-16 rounded-md border-gray-300 shadow-sm text-sm" disabled>
                    </div>
                </div>
                 <div>
                    <label for="emrAdditionalNotes" class="block font-medium text-gray-600 text-sm">Additional Notes for EMR:</label>
                    <textarea id="emrAdditionalNotes" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500" placeholder="Type any other relevant notes here..."></textarea>
                </div>
            </div>
            <div class="flex space-x-4 mb-4">
                 <button id="generateSummaryButton" class="bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded-lg transition-colors w-1/2">Generate EMR Summary</button>
                 <button id="copySummaryButton" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors w-1/2">Copy to Clipboard</button>
            </div>
            <textarea id="emrSummary" rows="12" class="w-full p-2 border border-gray-300 rounded-md bg-gray-50" readonly placeholder="Your summary will appear here..."></textarea>
             <div class="mt-6 text-center">
                <button id="resetButton" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Reset Form</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const scoreInputs = document.querySelectorAll('.score-input');
            const totalScoreEl = document.getElementById('totalScore');
            const riskCategoryEl = document.getElementById('riskCategory');
            const hardStopRadios = document.querySelectorAll('.hard-stop-radio');
            const scoringContainer = document.getElementById('scoringContainer');
            const hardStopSection = document.getElementById('hardStopSection');
            const resetButton = document.getElementById('resetButton');
            const generateSummaryButton = document.getElementById('generateSummaryButton');
            const copySummaryButton = document.getElementById('copySummaryButton');
            const emrSummaryEl = document.getElementById('emrSummary');
            const losDaysInput = document.getElementById('losDays');
            const losCheckbox = document.getElementById('losCheckbox');
            const reviewTypeRadios = document.querySelectorAll('input[name="review_type"]');
            const reviewDayInput = document.getElementById('reviewDay');
            const nursingConcernRadios = document.querySelectorAll('input[name="concern_score"]');
            const nursingConcernText = document.getElementById('nursingConcernText');
            const linesCvcRadio = document.querySelector('input[name="lines_score"][data-score="5"]');
            const deviceCvcCheckbox = document.getElementById('device_cvc');
            const mandatoryActionCheckbox = document.getElementById('mandatory_action_checkbox');

            function calculateScore() {
                let total = 0;
                scoreInputs.forEach(input => {
                    if (input.checked && input.dataset.score !== "0") {
                        total += parseInt(input.dataset.score, 10);
                    }
                });
                totalScoreEl.textContent = total;
                updateRiskCategory(total);
            }

            function updateRiskCategory(score) {
                riskCategoryEl.classList.remove('category-2', 'category-1', 'unsafe');
                if (score > 40) {
                    riskCategoryEl.textContent = 'Unsafe for Ward: Postpone discharge';
                    riskCategoryEl.classList.add('unsafe');
                } else if (score >= 10) {
                    riskCategoryEl.textContent = 'Category 1: Enhanced follow-up for up to 72 hours';
                    riskCategoryEl.classList.add('category-1');
                } else {
                    riskCategoryEl.textContent = 'Category 2: Standard follow-up';
                    riskCategoryEl.classList.add('category-2');
                }
            }

            function checkHardStops() {
                let isHardStopActive = false;
                hardStopRadios.forEach(radio => {
                    if (radio.value === 'fail' && radio.checked) {
                        isHardStopActive = true;
                    }
                });

                if (isHardStopActive) {
                    scoringContainer.style.opacity = '0.3';
                    scoringContainer.style.pointerEvents = 'none';
                    hardStopSection.classList.add('hard-stop-active');
                    riskCategoryEl.classList.remove('category-2', 'category-1');
                    riskCategoryEl.classList.add('unsafe');
                    riskCategoryEl.textContent = 'HARD STOP: DISCHARGE PAUSED';
                    totalScoreEl.textContent = '---';
                } else {
                    scoringContainer.style.opacity = '1';
                    scoringContainer.style.pointerEvents = 'auto';
                    hardStopSection.classList.remove('hard-stop-active');
                    calculateScore();
                }
            }
            
            function resetForm() {
                document.querySelectorAll('input[type="checkbox"]').forEach(input => input.checked = false);
                document.querySelectorAll('input[type="radio"]').forEach(input => {
                    if (input.name.startsWith('hardStop_') || input.name === 'review_type') {
                         if (input.value === 'pass' || input.value === 'pre') input.checked = true;
                    } else {
                        const group = document.querySelectorAll(`input[name="${input.name}"]`);
                        group.forEach(rb => {
                            if (rb.dataset.score === "0") {
                                rb.checked = true;
                            }
                        });
                    }
                });
                
                document.getElementById('patientInitials').value = '';
                document.getElementById('urnLast4').value = '';
                document.getElementById('losDays').value = '';
                document.getElementById('admissionReason').value = '';
                document.getElementById('dischargeDate').value = '';
                document.getElementById('assessmentDateTime').value = '';
                document.getElementById('reviewDay').value = '';
                document.getElementById('emrAdditionalNotes').value = '';
                document.getElementById('pivc_count').value = '';
                document.getElementById('drain_count').value = '';
                emrSummaryEl.value = '';
                toggleReviewDayInput();
                toggleNursingConcernText();
                checkHardStops();
            }

            function generateSummary() {
                let summaryText = '';
                const reviewType = document.querySelector('input[name="review_type"]:checked').value;
                if (reviewType === 'pre') {
                    summaryText += 'ALERT CNS pre ICU stepdown review\n';
                } else {
                    const day = document.getElementById('reviewDay').value || 'X';
                    summaryText += `ALERT CNS post ICU review on ward - Day ${day}\n`;
                }

                const patientInitials = document.getElementById('patientInitials').value || 'N/A';
                const urnLast4 = document.getElementById('urnLast4').value || 'N/A';
                const los = document.getElementById('losDays').value || 'N/A';
                const totalScore = totalScoreEl.textContent;
                const categoryText = riskCategoryEl.textContent.split(':')[0]; 

                summaryText += `Patient Initials: ${patientInitials}, Last 4 Digits of URN: ${urnLast4}\n`;
                summaryText += `ICU LOS: ${los} days\n`;
                summaryText += `Risk Score: ${totalScore} -> ${categoryText} discharge\n\n`;
                
                summaryText += `ADDS:\nA: \nB: \nC: \nD: \nE: \n\n`;
                
                const bloodRisks = [];
                document.querySelectorAll('#scoringContainer input[data-score]').forEach(input => {
                    if(input.checked && input.dataset.score !== "0" && input.closest('.space-y-2').previousElementSibling.textContent === 'B: Bloods') {
                        const label = input.closest('label').textContent.trim().replace(/\(\+\d+\)/, '').trim();
                        bloodRisks.push(label);
                    }
                });
                summaryText += `Bloods: ${bloodRisks.length > 0 ? bloodRisks.join(', ') : 'Within normal limits.'}\n\n`;

                const devices = [];
                if (document.getElementById('device_pivc').checked) {
                    const count = document.getElementById('pivc_count').value || '?';
                    devices.push(`PIVC (x${count})`);
                }
                 if (document.getElementById('device_drain').checked) {
                    const count = document.getElementById('drain_count').value || '?';
                    devices.push(`Drain (x${count})`);
                }
                document.querySelectorAll('.device-checkbox:checked').forEach(device => {
                    if(device.id !== 'device_pivc' && device.id !== 'device_drain') {
                       devices.push(device.value);
                    }
                });
                summaryText += `Devices: ${devices.length > 0 ? devices.join(', ') : 'None.'}\n\n`;
                
                const fluidStatus = document.querySelector('input[name="fluid_status_score"]:checked').closest('label').textContent.trim().replace(/\(\+\d+\)/, '').trim();
                summaryText += `Fluid Status: ${fluidStatus}\n\n`;

                const diet = document.querySelector('input[name="diet_score"]:checked').closest('label').textContent.trim().replace(/\(\+\d+\)/, '').trim();
                summaryText += `Diet: ${diet}\n\n`;

                const mobility = document.querySelector('input[name="mobility_score"]:checked').closest('label').textContent.trim().replace(/\(\+\d+\)/, '').trim();
                summaryText += `Mobility: ${mobility}\n\n`;

                summaryText += `Allergies: \n\n`;
                
                summaryText += `Other Identified Risk Factors:\n`;
                let otherRiskFactorsFound = false;
                scoreInputs.forEach(input => {
                     if (input.checked && input.dataset.score !== "0") {
                        const moduleHeader = input.closest('.space-y-2').previousElementSibling.textContent;
                        if(moduleHeader !== 'A: ADDS' && moduleHeader !== 'B: Bloods') {
                            const label = input.closest('label');
                            if (label) {
                                let text = label.textContent.trim().replace(/\(\+\d+\)/, '').trim();
                                if (input.name === 'concern_score' && input.dataset.score === '5') {
                                    const concernDetail = nursingConcernText.value.trim();
                                    if (concernDetail) {
                                        text += `: ${concernDetail}`;
                                    }
                                }
                                summaryText += `• ${text}\n`;
                                otherRiskFactorsFound = true;
                            }
                        }
                    }
                });

                if (mandatoryActionCheckbox.checked) {
                    summaryText += `• Electrolyte replacement plan for CTS/Cardiac patient requested from MO.\n`;
                    otherRiskFactorsFound = true;
                }

                if (!otherRiskFactorsFound) {
                    summaryText += `• None identified.\n`;
                }
                
                const additionalNotes = document.getElementById('emrAdditionalNotes').value.trim();
                if (additionalNotes) {
                    summaryText += `\nAdditional Notes:\n${additionalNotes}\n`;
                }

                emrSummaryEl.value = summaryText;
            }

            function copySummary() {
                emrSummaryEl.select();
                try {
                    document.execCommand('copy');
                    copySummaryButton.textContent = 'Copied!';
                    setTimeout(() => {
                        copySummaryButton.textContent = 'Copy to Clipboard';
                    }, 2000);
                } catch (err) {
                    console.error('Fallback: Unable to copy', err);
                    alert('Could not copy text. Please select and copy manually.');
                }
            }
            
            function handleLosInput() {
                const days = parseFloat(losDaysInput.value);
                if (days > 3) {
                    losCheckbox.checked = true;
                } else {
                    losCheckbox.checked = false;
                }
                losCheckbox.dispatchEvent(new Event('change'));
            }

            function toggleReviewDayInput() {
                if (document.querySelector('input[name="review_type"]:checked').value === 'post') {
                    reviewDayInput.disabled = false;
                } else {
                    reviewDayInput.disabled = true;
                    reviewDayInput.value = '';
                }
            }
            
            function toggleNursingConcernText() {
                const significantConcernRadio = document.querySelector('input[name="concern_score"][data-score="5"]');
                if (significantConcernRadio.checked) {
                    nursingConcernText.style.display = 'block';
                } else {
                    nursingConcernText.style.display = 'none';
                    nursingConcernText.value = '';
                }
            }
            
            function handleCvcAutomation() {
                 if (linesCvcRadio.checked) {
                    deviceCvcCheckbox.checked = true;
                 }
            }

            scoreInputs.forEach(input => input.addEventListener('change', calculateScore));
            hardStopRadios.forEach(radio => radio.addEventListener('change', checkHardStops));
            resetButton.addEventListener('click', resetForm);
            generateSummaryButton.addEventListener('click', generateSummary);
            copySummaryButton.addEventListener('click', copySummary);
            losDaysInput.addEventListener('input', handleLosInput);
            reviewTypeRadios.forEach(radio => radio.addEventListener('change', toggleReviewDayInput));
            nursingConcernRadios.forEach(radio => radio.addEventListener('change', toggleNursingConcernText));
            linesCvcRadio.addEventListener('change', handleCvcAutomation);

            // Set default assessment time to now
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('assessmentDateTime').value = now.toISOString().slice(0,16);
            
            calculateScore();
            checkHardStops();
        });
    </script>
</body>
</html>

