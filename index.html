  <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive ALERT Nursing Risk Assessment Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F0F9F9; /* A very light teal background */
        }
        .category-2 { background-color: #4FD1C5; color: #134E4A; } /* Light Teal */
        .category-1 { background-color: #F6E05E; color: #1A202C; } /* Yellow */
        .category-1-high { background-color: #F97316; color: #FFFFFF; } /* Orange */
        .unsafe { background-color: #FC8181; color: #1A202C; } /* Red */
        .header-gradient {
            background: linear-gradient(to right, #0D9488, #0F766E); /* Dark Teal Gradient */
        }
        .final-score-bg {
            background-color: #134E4A; /* Very Dark Teal */
        }
        .form-input {
            @apply mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 p-2 text-sm;
        }
        .sub-label {
            @apply block text-sm font-medium text-gray-600;
        }
        .module-bg-a { background-color: #fff1f2; } /* Light Pink for Critical Risks */
        .module-bg-b { background-color: #f0f9ff; }
        .module-bg-c { background-color: #f0fdf4; }
        .module-bg-d { background-color: #fffbeb; }
        .module-bg-e { background-color: #fef2f2; }
        .module-title {
            @apply font-bold text-xl mb-3 p-3 rounded-t-lg;
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">

    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg mb-6 overflow-hidden">
            <div class="header-gradient p-6 flex items-center justify-center text-white">
                 <div class="bg-white/20 rounded-full p-2 mr-4">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                </div>
                <h1 class="text-2xl sm:text-3xl font-bold">ALERT Nursing Risk Assessment Tool</h1>
            </div>
            <div class="p-6 bg-gray-50 border-t-4 border-teal-100">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                    <div>
                        <label for="patientInitials" class="block font-medium text-gray-600">Patient Initials:</label>
                        <input type="text" id="patientInitials" class="form-input">
                    </div>
                    <div>
                        <label for="urnLast4" class="block font-medium text-gray-600">Last 4 Digits of URN:</label>
                        <input type="text" id="urnLast4" class="form-input">
                    </div>
                     <div>
                        <label for="ward" class="block font-medium text-gray-600">Ward & Room No.:</label>
                        <div class="flex space-x-2">
                            <input type="text" id="ward" class="form-input" placeholder="Ward">
                            <input type="text" id="roomNumber" class="form-input" placeholder="Room">
                        </div>
                    </div>
                    <div>
                        <label for="losDays" class="block font-medium text-gray-600">ICU LOS (days):</label>
                        <input type="number" id="losDays" min="0" class="form-input">
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Clinical Parameters -->
        <div class="bg-white rounded-xl shadow-lg mb-6 p-6">
            <h2 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">Clinical Parameters (for auto-scoring)</h2>
            <!-- A-E Assessment -->
            <div class="mb-6 bg-gray-50 p-4 rounded-lg">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-semibold text-gray-700">A-E Assessment</h3>
                    <div class="text-right">
                        <span class="text-sm font-medium text-gray-500">Calculated ADDS:</span>
                        <span id="calculatedADDSScore" class="font-bold text-lg text-teal-600">0</span>
                    </div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div>
                        <label class="sub-label">Airway</label>
                        <input type="text" id="airway_input" class="form-input" value="Patent">
                    </div>
                    <div>
                        <label class="sub-label">Resp Rate</label>
                        <input type="number" id="rr_input" class="form-input vital-input">
                    </div>
                    <div>
                        <label class="sub-label">SpO2 (%)</label>
                        <input type="number" id="spo2_input" class="form-input vital-input">
                    </div>
                     <div>
                        <label class="sub-label">O2 Device</label>
                        <input type="text" id="o2_device_input" class="form-input" placeholder="e.g., RA or 2L NP">
                    </div>
                    <div>
                        <label class="sub-label">Heart Rate</label>
                        <input type="number" id="hr_input" class="form-input vital-input">
                    </div>
                    <div>
                        <label class="sub-label">SBP (mmHg)</label>
                        <input type="number" id="sbp_input" class="form-input vital-input">
                    </div>
                    <div>
                        <label class="sub-label">DBP (mmHg)</label>
                        <input type="number" id="dbp_input" class="form-input">
                    </div>
                     <div>
                        <label class="sub-label">Consciousness</label>
                        <select id="consciousness_input" class="form-input vital-input">
                            <option value="0">Alert</option>
                            <option value="1">Voice</option>
                            <option value="2">Pain</option>
                            <option value="3">Unresponsive</option>
                        </select>
                    </div>
                    <div>
                        <label class="sub-label">Temp (°C)</label>
                        <input type="number" step="0.1" id="temp_input" class="form-input vital-input">
                    </div>
                    <div>
                        <label class="sub-label">Urine (mls/hr)</label>
                        <input type="number" id="urine_input" class="form-input vital-input">
                    </div>
                </div>
            </div>
            <!-- Key Bloods -->
            <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="font-semibold text-gray-700 mb-2">Key Bloods</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div><label class="sub-label">Lactate</label><input type="number" step="0.1" id="lactate_input" class="form-input blood-input"></div>
                    <div><label class="sub-label">Creatinine</label><input type="number" id="creatinine_input" class="form-input blood-input"></div>
                    <div><label class="sub-label">Albumin</label><input type="number" id="albumin_input" class="form-input blood-input"></div>
                    <div><label class="sub-label">CRP</label><input type="number" id="crp_input" class="form-input blood-input"></div>
                    <div><label class="sub-label">Hb</label><input type="number" id="hb_input" class="form-input blood-input"></div>
                    <div><label class="sub-label">K+</label><input type="number" step="0.1" id="k_input" class="form-input"></div>
                    <div><label class="sub-label">Mg++</label><input type="number" step="0.1" id="mg_input" class="form-input"></div>
                </div>
            </div>
        </div>

        <!-- Scoring section container -->
        <div id="scoringContainer">
            <div class="bg-white rounded-xl shadow-lg mb-6 p-6">
                <h2 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">RISK SCORING ASSESSMENT</h2>
                <div class="space-y-6">
                    <!-- Critical Risk Factors -->
                    <div class="p-4 rounded-lg module-bg-a">
                        <h3 class="module-title bg-rose-200 text-rose-800">Critical Risk Factors</h3>
                        <div class="space-y-2 p-4">
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="15" data-id="crit_met"> <span class="ml-2">Currently in MET criteria (+15)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="10" data-id="crit_adds4" id="crit_adds4_checkbox"> <span class="ml-2">ADDS Score ≥ 4 (+10)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="10" data-id="crit_lactate_high" id="crit_lactate_high_checkbox"> <span class="ml-2">Lactate ≥ 3.5 mmol/L (+10)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="10" data-id="crit_af"> <span class="ml-2">Unstable Atrial Fibrillation (+10)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="10" data-id="crit_bleeding" id="crit_bleeding_checkbox"> <span class="ml-2">Falling Hb / Active Bleeding (+10)</span></label>
                        </div>
                    </div>
                    <!-- Physiological & Respiratory -->
                    <div class="rounded-lg module-bg-b">
                        <h3 class="module-title bg-blue-200 text-blue-800">Physiological & Respiratory Stability</h3>
                        <div class="space-y-2 p-4">
                            <label class="flex items-center"><input type="radio" name="adds_score" class="score-input" data-score="0" data-id="adds_0" id="adds_0_radio" checked> <span class="ml-2">Current ADDS Score 0 (+0)</span></label>
                            <label class="flex items-center"><input type="radio" name="adds_score" class="score-input" data-score="1" data-id="adds_1-2" id="adds_1-2_radio"> <span class="ml-2">Current ADDS Score 1-2 (+1)</span></label>
                            <label class="flex items-center"><input type="radio" name="adds_score" class="score-input" data-score="5" data-id="adds_3" id="adds_3_radio"> <span class="ml-2">Current ADDS Score 3 (+5)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="5" data-id="adds_worsening"> <span class="ml-2">Worsening ADDS Trend (last 12-24h) (+5)</span></label>
                            <hr class="my-3">
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="10" data-id="resp_increasing_o2"> <span class="ml-2">Increasing O2 requirements in last 12h (+10)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="6" data-id="resp_rapid_wean"> <span class="ml-2">Rapid weaning of respiratory support in last 4h (e.g. from high-flow >30L/min to low-flow nasal prongs) (+6)</span></label>
                        </div>
                    </div>
                    <!-- Bloods -->
                    <div class="p-4 rounded-lg module-bg-c">
                        <h3 class="module-title bg-green-200 text-green-800">Bloods</h3>
                        <div class="space-y-2 p-4">
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="4" data-id="bloods_electrolytes"> <span class="ml-2">Abnormal Electrolytes (K+, Mg++, Na+, Phos) (+4)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="4" data-id="bloods_lactate_mid" id="bloods_lactate_mid_checkbox"> <span class="ml-2">Lactate 2.0 - 3.4 (+4)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="4" data-id="bloods_creatinine" id="bloods_creatinine_checkbox"> <span class="ml-2">Creatinine >200 µmol/L (+4)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="3" data-id="bloods_albumin" id="bloods_albumin_checkbox"> <span class="ml-2">Albumin <25 g/L (+3)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="3" data-id="bloods_crp" id="bloods_crp_checkbox"> <span class="ml-2">CRP >100 mg/L (static/rising) (+3)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="3" data-id="bloods_anaemia" id="bloods_anaemia_checkbox"> <span class="ml-2">Anaemia (Hb < 80 g/L) (+3)</span></label>
                        </div>
                    </div>
                    <!-- Clinical -->
                    <div class="p-4 rounded-lg module-bg-d">
                        <h3 class="module-title bg-yellow-200 text-yellow-800">Clinical</h3>
                        <div class="space-y-2 p-4">
                            <label class="flex items-center"><input type="radio" name="pain_score" class="score-input" data-score="0" data-id="pain_0" checked> <span class="ml-2 text-gray-500">Pain: None / Well Controlled</span></label>
                            <label class="flex items-center"><input type="radio" name="pain_score" class="score-input" data-score="3" data-id="pain_iv"> <span class="ml-2">Pain: Requires regular IV/potent analgesia (+3)</span></label>
                            <label class="flex items-center"><input type="radio" name="pain_score" class="score-input" data-score="5" data-id="pain_pca"> <span class="ml-2">Pain: Poorly controlled / PCA (+5)</span></label>
                            <hr class="my-2">
                            <label class="flex items-center"><input type="radio" name="fluid_status_score" class="score-input" data-score="0" data-id="fluid_0" checked> <span class="ml-2 text-gray-500">Fluid Status: Euvolaemic</span></label>
                            <label class="flex items-center"><input type="radio" name="fluid_status_score" class="score-input" data-score="2" data-id="fluid_mild"> <span class="ml-2">Mild Dehydration/Oedema (e.g., dry mucous membranes, +1 oedema) (+2)</span></label>
                            <label class="flex items-center"><input type="radio" name="fluid_status_score" class="score-input" data-score="4" data-id="fluid_sig"> <span class="ml-2">Significant Dehydration/Oedema (e.g., poor turgor, +2 oedema, FBC +>2L/24h) (+4)</span></label>
                            <hr class="my-2">
                            <label class="flex items-center"><input type="radio" name="diet_score" class="score-input" data-score="0" data-id="diet_0" checked> <span class="ml-2 text-gray-500">Diet: Eating & Drinking Normally</span></label>
                            <label class="flex items-center"><input type="radio" name="diet_score" class="score-input" data-score="2" data-id="diet_modified"> <span class="ml-2">Diet: Supplements / Modified (+2)</span></label>
                            <label class="flex items-center"><input type="radio" name="diet_score" class="score-input" data-score="4" data-id="diet_nbm"> <span class="ml-2">Diet: NBM / NG / TPN (+4)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="3" data-id="bowels_issue"> <span class="ml-2">Bowels: Not opened >3 days / Ileus (+3)</span></label>
                            <hr class="my-2">
                            <label class="flex items-center"><input type="radio" name="delirium_score" class="score-input" data-score="0" data-id="delirium_0" checked> <span class="ml-2 text-gray-500">Delirium: None</span></label>
                            <label class="flex items-center"><input type="radio" name="delirium_score" class="score-input" data-score="4" data-id="delirium_mild"> <span class="ml-2">Delirium: Mild / Subsyndromal (+4)</span></label>
                            <label class="flex items-center"><input type="radio" name="delirium_score" class="score-input" data-score="8" data-id="delirium_mod"> <span class="ml-2">Delirium: Moderate to Severe (+8)</span></label>
                            <hr class="my-2">
                            <label class="flex items-center"><input type="radio" name="mobility_score" class="score-input" data-score="0" data-id="mobility_0" checked> <span class="ml-2 text-gray-500">Mobility: At Baseline</span></label>
                            <label class="flex items-center"><input type="radio" name="mobility_score" class="score-input" data-score="2" data-id="mobility_assisted"> <span class="ml-2">Mobility: Assisted (+2)</span></label>
                            <label class="flex items-center"><input type="radio" name="mobility_score" class="score-input" data-score="5" data-id="mobility_bedbound"> <span class="ml-2">Mobility: Bed-bound (+5)</span></label>
                            <hr class="my-2">
                            <label class="flex items-center"><input type="radio" name="airway_score" class="score-input" data-score="0" data-id="airway_0" checked> <span class="ml-2 text-gray-500">Airway Clearance: Good/Effective Cough</span></label>
                            <label class="flex items-center"><input type="radio" name="airway_score" class="score-input" data-score="4" data-id="airway_weak"> <span class="ml-2">Airway Clearance: Weak cough (+4)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="5" data-id="airway_altered"> <span class="ml-2">Altered Airway (Tracheostomy/Laryngectomy) (+5)</span></label>
                            <hr class="my-2">
                            <label class="flex items-center"><input type="radio" name="lines_score" class="score-input" data-score="0" data-id="lines_0" checked> <span class="ml-2 text-gray-500">Lines: None / PIVC only</span></label>
                            <label class="flex items-center"><input type="radio" name="lines_score" class="score-input" data-score="5" data-id="lines_cvc"> <span class="ml-2">Lines: CVC or Vascath (+5)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="3" data-id="drains_high_risk"> <span class="ml-2">High-Risk Drain present (e.g., mediastinal, ICC) OR drain with concerning output (+3)</span></label>
                            <hr class="my-2">
                            <div class="pt-2">
                                <label class="flex items-center"><input type="radio" name="concern_score" class="score-input" data-score="0" data-id="concern_0" checked> <span class="ml-2 text-gray-500">Nursing Concern: None</span></label>
                                <label class="flex items-center"><input type="radio" name="concern_score" class="score-input" data-score="5" data-id="concern_present"> <span class="ml-2">Nursing Concern Present (+5)</span></label>
                                <textarea id="nursingConcernText" class="mt-2 ml-6 w-full rounded-md border-gray-300 shadow-sm text-sm" rows="2" placeholder="Specify concern..." style="display: none;"></textarea>
                            </div>
                        </div>
                    </div>
                     <!-- Systemic -->
                    <div class="p-4 rounded-lg module-bg-e">
                        <h3 class="module-title bg-red-200 text-red-800">Systemic</h3>
                        <div class="space-y-2 p-4">
                            <label class="flex items-center"><input type="checkbox" id="losCheckbox" class="score-input" data-score="4" data-id="systemic_los"> <span class="ml-2">LOS > 72 hours (+4)</span></label>
                            <label class="flex items-center"><input type="radio" name="frailty_score" class="score-input" data-score="0" data-id="frailty_0" checked> <span class="ml-2 text-gray-500">Frailty: Not Frail</span></label>
                            <label class="flex items-center"><input type="radio" name="frailty_score" class="score-input" data-score="2" data-id="frailty_mild"> <span class="ml-2">Frailty: Mild (+2)</span></label>
                            <label class="flex items-center"><input type="radio" name="frailty_score" class="score-input" data-score="4" data-id="frailty_mod"> <span class="ml-2">Frailty: Mod-Severe (+4)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="4" id="comorbiditiesCheckbox" data-id="systemic_comorbid"> <span class="ml-2"><span class="comorbidity-main-text">≥3 chronic comorbidities</span> <span class="text-gray-400 text-xs">(e.g. IHD, COPD, T2DM)</span> (+4)</span></label>
                            <label class="flex items-center"><input type="checkbox" class="score-input" data-score="3" data-id="systemic_ooh"> <span class="ml-2">Out-of-Hours Discharge (+3)</span></label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Optional Narrative Details Section -->
        <div class="bg-white rounded-xl shadow-lg mb-6 p-6">
            <h2 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">Optional Narrative Details for DMR</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                <div class="md:col-span-2">
                    <label for="admissionReason" class="block font-medium text-gray-600">Reason for ICU Admission:</label>
                    <textarea id="admissionReason" rows="2" class="form-input"></textarea>
                </div>
                <div class="md:col-span-2">
                    <label for="pmh" class="block font-medium text-gray-600">Past Medical History (PMH):</label>
                    <textarea id="pmh" rows="3" class="form-input" placeholder="e.g., # HFreEF, # T2DM..."></textarea>
                </div>
                <div class="md:col-span-2">
                    <label for="icuSummary" class="block font-medium text-gray-600">ICU Summary / Timeline:</label>
                    <textarea id="icuSummary" rows="4" class="form-input" placeholder="e.g., 07/08: Admitted, intubated...&#10;10/08: Extubated..."></textarea>
                </div>
                <div>
                    <label for="deviceSpecifics" class="block font-medium text-gray-600">Device Specifics:</label>
                    <textarea id="deviceSpecifics" rows="4" class="form-input" placeholder="e.g., CVC Rt IJ external length 5.5cm..."></textarea>
                </div>
                <div>
                    <label for="wounds" class="block font-medium text-gray-600">Wounds:</label>
                    <textarea id="wounds" rows="4" class="form-input" placeholder="e.g., Chest, subcostal wounds dressed, clean and dry..."></textarea>
                </div>
                <div>
                    <label for="impression" class="block font-medium text-gray-600">Impression:</label>
                    <textarea id="impression" rows="3" class="form-input" placeholder="e.g., Stable since stepdown from ICU to ward..."></textarea>
                </div>
                 <div>
                    <label for="emrAdditionalNotes" class="block font-medium text-gray-600">Additional Plan Notes:</label>
                    <textarea id="emrAdditionalNotes" rows="3" class="form-input" placeholder="Type any other specific plan items here..."></textarea>
                </div>
            </div>
        </div>

        <!-- Final Review -->
        <div class="bg-white rounded-xl shadow-lg mb-6 p-6">
            <h2 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">FINAL REVIEW & STRATIFICATION</h2>
            <div class="space-y-4">
                <div class="bg-teal-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-lg text-teal-800 mb-2">Mandatory Action for CTS or Cardiac History Patients</h3>
                    <div class="flex items-center">
                        <input id="mandatory_action_checkbox" type="checkbox" class="h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500">
                        <label for="mandatory_action_checkbox" class="ml-3 block text-sm font-medium text-gray-700">
                           Confirm plan is in place to target <strong>K+ ~4.0</strong> and <strong>Mg++ ~1.0</strong>.
                        </label>
                    </div>
                </div>
                <div class="final-score-bg text-white rounded-xl shadow-lg p-6">
                     <div class="flex flex-col sm:flex-row justify-between items-center text-center">
                        <div class="mb-4 sm:mb-0">
                            <span class="text-lg font-medium text-gray-400">TOTAL SCORE</span>
                            <div id="totalScore" class="text-5xl font-bold">0</div>
                        </div>
                        <div class="w-full sm:w-auto">
                            <span class="text-lg font-medium text-gray-400">FINAL CATEGORY & ACTION</span>
                            <div id="riskCategory" class="text-xl font-bold p-3 rounded-md mt-1 transition-all duration-300">
                                Category 2: Standard follow-up
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- DMR Summary Section -->
        <div class="bg-white rounded-xl shadow-lg mt-6 p-6">
            <h2 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">DMR Summary Generator</h2>
            <div class="flex space-x-4 mb-4">
                 <button id="generateSummaryButton" class="bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded-lg transition-colors w-1/2">Generate DMR Summary</button>
                 <button id="copySummaryButton" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors w-1/2">Copy to Clipboard</button>
            </div>
            <textarea id="emrSummary" rows="15" class="w-full p-2 border border-gray-300 rounded-md bg-gray-50" readonly placeholder="Your summary will appear here..."></textarea>
             <div class="mt-6 text-center">
                <button id="resetButton" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Reset Form</button>
            </div>
        </div>
    </div>

    <script>
        const scoreInputs = document.querySelectorAll('.score-input');
        const totalScoreEl = document.getElementById('totalScore');
        const riskCategoryEl = document.getElementById('riskCategory');
        const resetButton = document.getElementById('resetButton');
        const generateSummaryButton = document.getElementById('generateSummaryButton');
        const copySummaryButton = document.getElementById('copySummaryButton');
        const emrSummaryEl = document.getElementById('emrSummary');
        const losDaysInput = document.getElementById('losDays');
        const losCheckbox = document.getElementById('losCheckbox');
        const nursingConcernRadios = document.querySelectorAll('input[name="concern_score"]');
        const nursingConcernText = document.getElementById('nursingConcernText');
        const mandatoryActionCheckbox = document.getElementById('mandatory_action_checkbox');
        const vitalInputs = document.querySelectorAll('.vital-input');
        const bloodInputs = document.querySelectorAll('.blood-input');
        const calculatedADDSEl = document.getElementById('calculatedADDSScore');
        
        const categoryMap = {
            'unsafe': 'Unsafe for Ward: Immediate senior review required',
            'category-1-high': 'Category 1 - High Risk: Escalate to ALERT medical rounding team',
            'category-1': 'Category 1: Enhanced follow-up for 72 hours',
            'category-2': 'Category 2: Standard follow-up'
        };

        const carePlanMap = {
            'resp_increasing_o2': 'Medical review to investigate cause of increasing O2 demand.',
            'resp_rapid_wean': 'Close monitoring of respiratory rate and SpO2. Consider ABG if signs of fatigue.',
            'bloods_electrolytes': 'Review electrolyte trends and ensure replacement plan is adequate.',
            'bloods_lactate_mid': 'Consider serial lactate measurements to ensure clearance.',
            'bloods_creatinine': 'Monitor fluid balance and renal function. Review nephrotoxic medications.',
            'bloods_albumin': 'Liaise with Dietitian for nutritional review. Consider albumin replacement as per protocol.',
            'bloods_crp': 'Continue to monitor for signs of infection/inflammation. Review antibiotic therapy if applicable.',
            'bloods_anaemia': 'Monitor for signs of bleeding. Consider transfusion if Hb drops further or patient is symptomatic.',
            'pain_iv': 'Liaise with Acute Pain Service for review of analgesic plan.',
            'pain_pca': 'Liaise with Acute Pain Service for review of analgesic plan.',
            'fluid_mild': 'Strict fluid balance monitoring. Medical review to consider diuretic or fluid challenge.',
            'fluid_sig': 'Strict fluid balance monitoring. Urgent medical review of fluid status.',
            'diet_modified': 'Liaise with Dietitian and Speech Pathology as required.',
            'diet_nbm': 'Liaise with Dietitian to establish feeding plan.',
            'bowels_issue': 'Commence aperients as per protocol. Consider medical review if no result in 24h or signs of obstruction.',
            'delirium_mild': 'Implement delirium prevention/management strategies. Minimize deliriogenic medications.',
            'delirium_mod': 'Implement delirium prevention/management strategies. Medical review to investigate underlying causes.',
            'mobility_assisted': 'Physiotherapy review for mobility and strengthening plan.',
            'mobility_bedbound': 'Physiotherapy review for mobility and strengthening plan. Pressure area care plan essential.',
            'airway_weak': 'Physiotherapy review for secretion management and respiratory exercises.',
            'airway_altered': 'Ensure ward staff are confident with tracheostomy/laryngectomy care. Speech Pathology review as needed.',
            'lines_cvc': 'Ensure clear plan for CVC necessity and removal date.',
            'drains_high_risk': 'Ensure drain patency and monitor output closely. Liaise with surgical/parent team for specific management plan.',
            'concern_present': 'Clearly document specific nursing concerns for handover and medical team awareness.',
            'frailty_mild': 'Refer to Geriatrics/Allied Health for comprehensive discharge planning.',
            'frailty_mod': 'Refer to Geriatrics/Allied Health for comprehensive discharge planning.',
            'systemic_comorbid': 'Ensure all specialty teams (e.g., Cardiology, Respiratory) are aware of discharge and have a follow-up plan.',
            'systemic_ooh': 'Ensure comprehensive handover is given to after-hours team.',
            'crit_met': 'Immediate senior medical review required. Patient is not stable for ward transfer.',
            'crit_adds4': 'Increase observation frequency. Senior medical review to determine cause of deterioration.',
            'crit_lactate_high': 'Immediate senior medical review for management of shock state.',
            'crit_af': 'Cardiology review. Ensure rate/rhythm control plan is in place.',
            'crit_bleeding': 'Urgent medical review to identify and manage source of bleeding. Monitor coagulation profile.'
        };

        function calculateScore() {
            let total = 0;
            scoreInputs.forEach(input => {
                if (input.checked && input.dataset.score !== "0") {
                    total += parseInt(input.dataset.score, 10);
                }
            });
            totalScoreEl.textContent = total;
            updateRiskCategory(total);
        }

        function updateRiskCategory(score) {
            riskCategoryEl.classList.remove('category-2', 'category-1', 'category-1-high', 'unsafe');
            let categoryKey = 'category-2';
            if (score > 40) {
                categoryKey = 'unsafe';
            } else if (score >= 30) {
                categoryKey = 'category-1-high';
            } else if (score >= 12) {
                categoryKey = 'category-1';
            }
            riskCategoryEl.textContent = categoryMap[categoryKey];
            riskCategoryEl.classList.add(categoryKey);
        }
        
        function resetForm() {
            document.querySelectorAll('input[type="text"], input[type="number"], input[type="date"], input[type="datetime-local"], textarea').forEach(input => input.value = '');
            document.querySelectorAll('input[type="checkbox"]').forEach(input => input.checked = false);
            document.querySelectorAll('input[type="radio"]').forEach(input => {
                 const group = document.querySelectorAll(`input[name="${input.name}"]`);
                 group.forEach(rb => {
                     if (rb.dataset.score === "0" || rb.value === 'pre') {
                         rb.checked = true;
                     }
                 });
            });
            document.getElementById('consciousness_input').value = '0';
            document.getElementById('airway_input').value = 'Patent';
            toggleNursingConcernText();
            calculateADDS();
        }

        function generateSummary() {
            let summaryText = '';
            const reviewType = document.querySelector('input[name="review_type"]:checked')?.value;
            if (reviewType === 'pre') {
                summaryText += 'ALERT CNS pre ICU stepdown review\n';
            } else {
                const day = document.getElementById('reviewDay').value || 'X';
                summaryText += `ALERT CNS post ICU review on ward - Day ${day}\n`;
            }

            const los = document.getElementById('losDays').value;
            if(los) summaryText += `ICU LOS ${los} days\n`;

            const admissionReason = document.getElementById('admissionReason').value.trim();
            if(admissionReason) summaryText += `Admitted to ICU with ${admissionReason}\n`;

            summaryText += '\n';

            const pmh = document.getElementById('pmh').value.trim();
            if (pmh) summaryText += `PMH\n${pmh}\n\n`;

            const icuSummary = document.getElementById('icuSummary').value.trim();
            if (icuSummary) summaryText += `Summary\n${icuSummary}\n\n`;

            const totalScore = totalScoreEl.textContent;
            const categoryText = riskCategoryEl.textContent; 
            summaryText += `ALERT Score: ${totalScore} -> ${categoryText}\n\n`;
            
            const bloods = [];
            const k = document.getElementById('k_input').value;
            const mg = document.getElementById('mg_input').value;
            const lac = document.getElementById('lactate_input').value;
            const cr = document.getElementById('creatinine_input').value;
            const hb = document.getElementById('hb_input').value;
            const crp = document.getElementById('crp_input').value;
            const albumin = document.getElementById('albumin_input').value;
            if(k) bloods.push(`K ${k}`);
            if(mg) bloods.push(`Mg ${mg}`);
            if(lac) bloods.push(`Lac ${lac}`);
            if(cr) bloods.push(`Cr ${cr}`);
            if(hb) bloods.push(`Hb ${hb}`);
            if(crp) bloods.push(`CRP ${crp}`);
            if(albumin) bloods.push(`Albumin ${albumin}`);
            if(bloods.length > 0) summaryText += `Bloods\n${bloods.join(', ')}\n\n`;
            
            const deviceSpecifics = document.getElementById('deviceSpecifics').value.trim();
            if (deviceSpecifics) summaryText += `Devices\n${deviceSpecifics}\n\n`;

            const wounds = document.getElementById('wounds').value.trim();
            if (wounds) summaryText += `Wounds\n${wounds}\n\n`;
            
            let aeText = '';
            aeText += `ADDS ${calculatedADDSEl.textContent}\n`;
            aeText += `A: ${document.getElementById('airway_input').value}\n`;
            const rr = document.getElementById('rr_input').value;
            const spo2 = document.getElementById('spo2_input').value;
            const o2Device = document.getElementById('o2_device_input').value;
            if(rr || spo2) aeText += `B: RR ${rr || 'N/A'}, SpO2 ${spo2 || 'N/A'}% on ${o2Device || 'RA'}\n`;
            const hr = document.getElementById('hr_input').value;
            const sbp = document.getElementById('sbp_input').value;
            const dbp = document.getElementById('dbp_input').value;
            if(hr || sbp) aeText += `C: HR ${hr || 'N/A'}, NIBP ${sbp || 'N/A'}/${dbp || 'N/A'}\n`;
            const consciousnessEl = document.getElementById('consciousness_input');
            const consciousness = consciousnessEl.options[consciousnessEl.selectedIndex].text;
            if(consciousness) aeText += `D: ${consciousness}\n`;
            const temp = document.getElementById('temp_input').value;
            if(temp) aeText += `E: Temp ${temp}°C\n`;
            summaryText += `${aeText}\n`;

            const impression = document.getElementById('impression').value.trim();
            if (impression) summaryText += `Imp:\n${impression}\n\n`;
            
            summaryText += `Plan\n`;
            const carePlanItems = new Set();
            scoreInputs.forEach(input => {
                 if (input.checked && input.dataset.score !== "0") {
                    if (carePlanMap[input.dataset.id]) {
                        carePlanItems.add(carePlanMap[input.dataset.id]);
                    }
                }
            });
             if (mandatoryActionCheckbox.checked) {
                carePlanItems.add('Liaise with medical team to confirm K+ and Mg++ replacement plan is charted.');
            }

            if(carePlanItems.size > 0) {
                carePlanItems.forEach(item => {
                    summaryText += `• ${item}\n`;
                });
            } else {
                summaryText += `• Standard ward cares.\n`;
            }

            const additionalNotes = document.getElementById('emrAdditionalNotes').value.trim();
            if (additionalNotes) {
                summaryText += `${additionalNotes}\n`;
            }

            emrSummaryEl.value = summaryText;
        }

        function copySummary() {
            emrSummaryEl.select();
            try {
                document.execCommand('copy');
                copySummaryButton.textContent = 'Copied!';
                setTimeout(() => {
                    copySummaryButton.textContent = 'Copy to Clipboard';
                }, 2000);
            } catch (err) {
                console.error('Fallback: Unable to copy', err);
                alert('Could not copy text. Please select and copy manually.');
            }
        }
        
        function handleLosInput() {
            const days = parseFloat(losDaysInput.value);
            losCheckbox.checked = days > 3;
            losCheckbox.dispatchEvent(new Event('change'));
        }
        
        function toggleNursingConcernText() {
            const significantConcernRadio = document.querySelector('input[name="concern_score"][data-score="5"]');
            nursingConcernText.style.display = significantConcernRadio.checked ? 'block' : 'none';
            if (!significantConcernRadio.checked) nursingConcernText.value = '';
        }

        function calculateADDS() {
            let adds = 0;
            const rr = parseInt(document.getElementById('rr_input').value, 10);
            const spo2 = parseInt(document.getElementById('spo2_input').value, 10);
            const hr = parseInt(document.getElementById('hr_input').value, 10);
            const sbp = parseInt(document.getElementById('sbp_input').value, 10);
            const consciousness = parseInt(document.getElementById('consciousness_input').value, 10);
            const temp = parseFloat(document.getElementById('temp_input').value);
            const urine = parseFloat(document.getElementById('urine_input').value);

            if (!isNaN(rr)) {
                if (rr > 35) adds += 3;
                else if (rr < 9 || rr > 29) adds += 2;
            }
            if (!isNaN(spo2)) {
                if (spo2 < 90) adds += 3;
                else if (spo2 < 93) adds += 2;
                else if (spo2 < 95) adds += 1;
            }
            if (!isNaN(hr)) {
                if (hr < 40 || hr > 129) adds += 3;
                else if (hr < 50 || hr > 109) adds += 2;
            }
            if (!isNaN(sbp)) {
                if (sbp < 80 || sbp > 199) adds += 3;
                else if (sbp < 90) adds += 2;
            }
            if (!isNaN(consciousness)) adds += consciousness;
            if (!isNaN(temp)) {
                if (temp > 39.0) adds += 3;
                else if (temp < 35.1 || temp > 38.0) adds += 2;
            }
            if (!isNaN(urine) && urine < 30) adds += 3;
            
            calculatedADDSEl.textContent = adds;
            
            document.getElementById('crit_adds4_checkbox').checked = false;
            document.getElementById('adds_0_radio').checked = false;
            document.getElementById('adds_1-2_radio').checked = false;
            document.getElementById('adds_3_radio').checked = false;

            if (adds >= 4) {
                document.getElementById('crit_adds4_checkbox').checked = true;
            } else if (adds === 3) {
                document.getElementById('adds_3_radio').checked = true;
            } else if (adds >= 1) {
                document.getElementById('adds_1-2_radio').checked = true;
            } else {
                document.getElementById('adds_0_radio').checked = true;
            }
            calculateScore();
        }

        function handleBloodInputs() {
            const lactate = parseFloat(document.getElementById('lactate_input').value);
            document.getElementById('crit_lactate_high_checkbox').checked = lactate >= 3.5;
            document.getElementById('bloods_lactate_mid_checkbox').checked = lactate >= 2.0 && lactate < 3.5;

            const creatinine = parseFloat(document.getElementById('creatinine_input').value);
            document.getElementById('bloods_creatinine_checkbox').checked = creatinine > 200;

            const albumin = parseFloat(document.getElementById('albumin_input').value);
            document.getElementById('bloods_albumin_checkbox').checked = albumin < 25;

            const crp = parseFloat(document.getElementById('crp_input').value);
            document.getElementById('bloods_crp_checkbox').checked = crp > 100;

            const hb = parseFloat(document.getElementById('hb_input').value);
            document.getElementById('bloods_anaemia_checkbox').checked = hb < 80;
            document.getElementById('crit_bleeding_checkbox').checked = hb < 80;

            calculateScore();
        }

        scoreInputs.forEach(input => input.addEventListener('change', calculateScore));
        resetButton.addEventListener('click', resetForm);
        generateSummaryButton.addEventListener('click', generateSummary);
        copySummaryButton.addEventListener('click', copySummary);
        losDaysInput.addEventListener('input', handleLosInput);
        nursingConcernRadios.forEach(radio => radio.addEventListener('change', toggleNursingConcernText));
        vitalInputs.forEach(input => input.addEventListener('input', calculateADDS));
        bloodInputs.forEach(input => input.addEventListener('input', handleBloodInputs));
        
        calculateADDS();
    </script>
</body>
</html>
